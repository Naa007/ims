<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!-- Head -->
<head th:replace="fragments/head :: head"><title>Enterprise Analytics Dashboard</title></head>
<body>
<!-- Header -->
<header th:replace="fragments/header :: header"></header>

<main class="bd-container">
    <div class="bd-dashboard-container">
        <div class="bd-dashboard-header">
            <div class="bd-dashboard-title">Enterprise Performance Analytics</div>
            <div class="bd-date-filter">
                <span th:text="${#temporals.format(#temporals.createNow(), 'MMMM dd, yyyy')}">April 14, 2025</span>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="bd-stats-grid">
            <!-- Inspection Stats Card -->
            <div class="bd-stat-card" th:if="${inspectionStats != null}">
                <div class="bd-stat-header" data-target="inspection-stats">
                    <div class="bd-stat-icon bd-inspection-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="bd-stat-title">Inspections</div>
                    <i class="fas fa-chevron-down bd-dropdown-icon"></i>
                </div>
                <div class="bd-stat-summary">
                    <div class="bd-summary-label">Total Inspections</div>
                    <div class="bd-summary-value" th:text="${inspectionStats['Total Inspections']}">0</div>
                </div>
                <div class="bd-stat-content" id="inspection-stats">
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">New</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['New']}">0</div>
                    </div>
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">Ongoing</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['Ongoing']}">0</div>
                    </div>
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">Awarded</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['Awarded']}">0</div>
                    </div>
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">Rejected</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['Rejected']}">0</div>
                    </div>
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">Closed</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['Closed']}">0</div>
                    </div>
                </div>
            </div>
            <!-- Employee Stats Card -->
            <div class="bd-stat-card" th:if="${employeeStats!= null}">
                <div class="bd-stat-header" data-target="employee-stats">
                    <div class="bd-stat-icon bd-employee-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="bd-stat-title">Employees</div>
                    <i class="fas fa-chevron-down bd-dropdown-icon"></i>
                </div>
                <div class="bd-stat-summary">
                    <div class="bd-summary-label">Total Employees</div>
                    <div class="bd-summary-value" th:text="${employeeStats['Total Employees']}">0</div>
                </div>
                <div class="bd-stat-content" id="employee-stats">
                    <div class="bd-stat-item" th:each="stat : ${employeeStats}"
                         th:if="${!stat.key.equals('Total Employees')}">
                        <div class="bd-stat-label" th:text="${stat.key}">Active Employees</div>
                        <div class="bd-stat-value" th:text="${stat.value}">0</div>
                    </div>
                </div>
            </div>

            <!-- Client Stats Card -->
            <div class="bd-stat-card" th:if="${clientStats != null}">
                <div class="bd-stat-header" data-target="client-stats">
                    <div class="bd-stat-icon bd-client-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="bd-stat-title">Clients</div>
                    <i class="fas fa-chevron-down bd-dropdown-icon"></i>
                </div>
                <div class="bd-stat-summary">
                    <div class="bd-summary-label">Total Clients</div>
                    <div class="bd-summary-value" th:text="${clientStats['Total Clients']}">0</div>
                </div>
                <div class="bd-stat-content" id="client-stats">
                    <div class="bd-stat-item" th:each="stat : ${clientStats}"
                         th:if="${!stat.key.equals('Total Clients')}">
                        <div class="bd-stat-label" th:text="${stat.key}">Active Clients</div>
                        <div class="bd-stat-value" th:text="${stat.value}">0</div>
                    </div>
                </div>
            </div>

            <!-- Inspector Stats Card -->
            <div class="bd-stat-card" th:if="${inspectorStats != null}">
                <div class="bd-stat-header" data-target="inspector-stats">
                    <div class="bd-stat-icon bd-inspector-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="bd-stat-title">Inspectors</div>
                    <i class="fas fa-chevron-down bd-dropdown-icon"></i>
                </div>
                <div class="bd-stat-summary">
                    <div class="bd-summary-label">Total Inspectors</div>
                    <div class="bd-summary-value" th:text="${inspectorStats['Total Inspectors']}">0</div>
                </div>
                <div class="bd-stat-content" id="inspector-stats">
                    <div class="bd-stat-item" th:each="stat : ${inspectorStats}"
                         th:if="${!stat.key.equals('Total Inspectors')}">
                        <div class="bd-stat-label" th:text="${stat.key}">Inhouse Inspectors</div>
                        <div class="bd-stat-value" th:text="${stat.value}">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Individual Performance Charts Section -->
        <div class="bd-chart-section">
            <div class="bd-section-header">
                <h2>Individual Performance Metrics</h2>
                <p>View detailed analytics by personnel role and time period</p>
            </div>

            <!-- Tab Navigation for Individual Charts -->
            <div class="bd-tab-navigation">
                <button class="bd-tab-button active" data-target="coordinator-chart-panel">Coordinators</button>
                <button class="bd-tab-button" data-target="technical-chart-panel">Technical Coordinators</button>
                <button class="bd-tab-button" data-target="inspector-chart-panel">Inspectors</button>
            </div>

            <!-- Chart Panels -->
            <div class="bd-chart-panels">
                <!-- Coordinator Panel -->
                <div class="bd-chart-panel active" id="coordinator-chart-panel">
                    <div class="bd-chart-card">
                        <div class="bd-chart-controls-container">
                            <div class="bd-chart-header">Coordinator Performance Analytics</div>

                            <div class="bd-filters-container">
                                <!-- Primary Selector -->
                                <div class="bd-filter-group bd-primary-filter">
                                    <label for="coordinatorSelect">Select Coordinator:</label>
                                    <select class="bd-select bd-primary-select" id="coordinatorSelect"
                                            onchange="handleCoordinatorChange(this)">
                                        <option disabled selected value="">Choose a coordinator</option>
                                        <option th:each="coordinator : ${coordinatorsList}"
                                                th:text="${coordinator.empName}"
                                                th:value="${coordinator.email}">
                                        </option>
                                    </select>
                                </div>

                                <!-- Chart Period Selection -->
                                <div class="bd-filter-group">
                                    <label for="coordinatorPeriodSelect">Time Range:</label>
                                    <select class="bd-period-select" id="coordinatorPeriodSelect"
                                            onchange="handleCoordinatorPeriodChange()">
                                        <option value="week">Last 7 Days</option>
                                        <option selected value="month">Last 30 Days</option>
                                        <option value="quarter">Last Quarter</option>
                                        <option value="year">Year to Date</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>

                                <!-- Export Options -->
                                <div class="bd-filter-group bd-export-group">
                                    <button class="bd-export-btn" onclick="exportCoordinatorData('pdf')">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                    <button class="bd-export-btn" onclick="exportCoordinatorData('excel')">
                                        <i class="fas fa-file-excel"></i> Excel
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Custom Date Range Container -->
                        <div class="bd-custom-range" id="coordinatorCustomRangeContainer" style="display: none;">
                            <div class="bd-custom-range-content">
                                <div class="bd-date-input-group">
                                    <label for="coordinatorStartDate">From:</label>
                                    <input id="coordinatorStartDate" name="coordinatorStartDate" type="date">
                                </div>
                                <div class="bd-date-input-group">
                                    <label for="coordinatorEndDate">To:</label>
                                    <input id="coordinatorEndDate" name="coordinatorEndDate" type="date">
                                </div>
                                <button class="bd-filter-btn" onclick="applyCoordinatorCustomRange()" type="button">
                                    Apply
                                </button>
                            </div>
                        </div>

                        <!-- Chart Container -->
                        <div class="bd-chart-container" style="position: relative; height:500px;">
                            <canvas id="coordinatorPerformanceChart"></canvas>
                        </div>

                        <!-- Data Summary Table -->
                        <div class="bd-data-summary">
                            <h3>Performance Summary</h3>
                            <div class="bd-data-table-container">
                                <table class="bd-data-table" id="coordinatorSummaryTable">
                                    <thead>
                                    <tr>
                                        <th>Status</th>
                                        <th>Count</th>
                                        <th>% of Total</th>
                                        <th>Trend</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <!-- This will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Technical Coordinator Panel -->
                <div class="bd-chart-panel" id="technical-chart-panel">
                    <div class="bd-chart-card">
                        <div class="bd-chart-controls-container">
                            <div class="bd-chart-header">Technical Coordinator Analytics</div>

                            <div class="bd-filters-container">
                                <!-- Primary Selector -->
                                <div class="bd-filter-group bd-primary-filter">
                                    <label for="technicalCoordinatorSelect">Select Technical Coordinator:</label>
                                    <select class="bd-select bd-primary-select" id="technicalCoordinatorSelect"
                                            onchange="handleTechnicalCoordinatorChange(this)">
                                        <option disabled selected value="">Choose a technical coordinator</option>
                                        <option th:each="technicalCoordinator : ${technicalCoordinatorsList}"
                                                th:text="${technicalCoordinator.empName}"
                                                th:value="${technicalCoordinator.empId}">
                                        </option>
                                    </select>
                                </div>

                                <!-- Chart Period Selection -->
                                <div class="bd-filter-group">
                                    <label for="technicalPeriodSelect">Time Range:</label>
                                    <select class="bd-period-select" id="technicalPeriodSelect"
                                            onchange="handleTechnicalPeriodChange()">
                                        <option value="week">Last 7 Days</option>
                                        <option selected value="month">Last 30 Days</option>
                                        <option value="quarter">Last Quarter</option>
                                        <option value="year">Year to Date</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>

                                <!-- Export Options -->
                                <div class="bd-filter-group bd-export-group">
                                    <button class="bd-export-btn" onclick="exportTechnicalData('pdf')">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                    <button class="bd-export-btn" onclick="exportTechnicalData('excel')">
                                        <i class="fas fa-file-excel"></i> Excel
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Custom Date Range Container -->
                        <div class="bd-custom-range" id="technicalCustomRangeContainer" style="display: none;">
                            <div class="bd-custom-range-content">
                                <div class="bd-date-input-group">
                                    <label for="technicalStartDate">From:</label>
                                    <input id="technicalStartDate" name="technicalStartDate" type="date">
                                </div>
                                <div class="bd-date-input-group">
                                    <label for="technicalEndDate">To:</label>
                                    <input id="technicalEndDate" name="technicalEndDate" type="date">
                                </div>
                                <button class="bd-filter-btn" onclick="applyTechnicalCustomRange()" type="button">
                                    Apply
                                </button>
                            </div>
                        </div>

                        <!-- Chart Container -->
                        <div class="bd-chart-container" style="position: relative; height:500px;">
                            <canvas id="technicalCoordinatorChart"></canvas>
                        </div>

                        <!-- Data Summary Table -->
                        <div class="bd-data-summary">
                            <h3>Performance Summary</h3>
                            <div class="bd-data-table-container">
                                <table class="bd-data-table" id="technicalSummaryTable">
                                    <thead>
                                    <tr>
                                        <th>Status</th>
                                        <th>Count</th>
                                        <th>% of Total</th>
                                        <th>Trend</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inspector Panel -->
                <div class="bd-chart-panel" id="inspector-chart-panel">
                    <div class="bd-chart-card">
                        <div class="bd-chart-controls-container">
                            <div class="bd-chart-header">Inspector Performance Analytics</div>

                            <div class="bd-filters-container">
                                <!-- Primary Selector -->
                                <div class="bd-filter-group bd-primary-filter">
                                    <label for="inspectorSelect">Select Inspector:</label>
                                    <select class="bd-select bd-primary-select" id="inspectorSelect"
                                            onchange="handleInspectorChange(this)">
                                        <option disabled selected value="">Choose an inspector</option>
                                        <option th:each="inspector : ${inspectorsList}"
                                                th:text="${inspector.inspectorName}"
                                                th:value="${inspector.email}">
                                        </option>
                                    </select>
                                </div>

                                <!-- Chart Period Selection -->
                                <div class="bd-filter-group">
                                    <label for="inspectorPeriodSelect">Time Range:</label>
                                    <select class="bd-period-select" id="inspectorPeriodSelect"
                                            onchange="handleInspectorPeriodChange()">
                                        <option value="week">Last 7 Days</option>
                                        <option selected value="month">Last 30 Days</option>
                                        <option value="quarter">Last Quarter</option>
                                        <option value="year">Year to Date</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>
                                <!-- Export Options -->
                                <div class="bd-filter-group bd-export-group">
                                    <button class="bd-export-btn" onclick="exportInspectorData('pdf')">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                    <button class="bd-export-btn" onclick="exportInspectorData('excel')">
                                        <i class="fas fa-file-excel"></i> Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Custom Date Range Container -->
                        <div class="bd-custom-range" id="inspectorCustomRangeContainer" style="display: none;">
                            <div class="bd-custom-range-content">
                                <div class="bd-date-input-group">
                                    <label for="inspectorStartDate">From:</label>
                                    <input id="inspectorStartDate" name="inspectorStartDate" type="date">
                                </div>
                                <div class="bd-date-input-group">
                                    <label for="inspectorEndDate">To:</label>
                                    <input id="inspectorEndDate" name="inspectorEndDate" type="date">
                                </div>
                                <button class="bd-filter-btn" onclick="applyInspectorCustomRange()" type="button">
                                    Apply
                                </button>
                            </div>
                        </div>
                        <!-- Chart Container -->
                        <div class="bd-chart-container" style="position: relative; height:500px;">
                            <canvas id="inspectorPerformanceChart"></canvas>
                        </div>

                        <!-- Data Summary Table -->
                        <div class="bd-data-summary">
                            <h3>Performance Summary</h3>
                            <div class="bd-data-table-container">
                                <table class="bd-data-table" id="inspectorSummaryTable">
                                    <thead>
                                    <tr>
                                        <th>Status</th>
                                        <th>Count</th>
                                        <th>% of Total</th>
                                        <th>Trend</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <!-- This will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Trends Section -->
        <div class="bd-trends-section">
            <div class="bd-section-header">
                <h2>Performance Trends</h2>
                <p>View historical trends and comparative analytics</p>
            </div>

            <div class="bd-trends-container">
                <div class="bd-trend-card">
                    <div class="bd-chart-header">Individual vs Team Performance</div>
                    <div class="bd-chart-container" style="position: relative; height:400px;">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<!-- Footer -->
<footer th:replace="fragments/footer :: footer"></footer>
<!-- Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize toggle for stat cards
        initializeStatCardToggles();

        // Initialize tab navigation
        initializeTabNavigation();

        // Initialize charts with default data
        initializeCharts();

        // Set current date for date inputs
        initializeDateInputs();
    });

    function initializeStatCardToggles() {
        const statHeaders = document.querySelectorAll('.bd-stat-header');

        statHeaders.forEach(header => {
            header.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const content = document.getElementById(targetId);
                const icon = this.querySelector('.bd-dropdown-icon');

                content.classList.toggle('expanded');
                icon.classList.toggle('active');
            });
        });
    }

    function initializeTabNavigation() {
        const tabButtons = document.querySelectorAll('.bd-tab-button');

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons and panels
                document.querySelectorAll('.bd-tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.bd-chart-panel').forEach(panel => panel.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                // Show the corresponding panel
                const targetPanelId = this.getAttribute('data-target');
                document.getElementById(targetPanelId).classList.add('active');
            });
        });
    }

    function initializeDateInputs() {
        // Set default dates to 30 days ago and today
        const today = new Date();
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);

        // Format dates for input fields
        const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        // Set date values for all custom range inputs
        const startDateInputs = document.querySelectorAll('[id$="StartDate"]');
        const endDateInputs = document.querySelectorAll('[id$="EndDate"]');

        startDateInputs.forEach(input => input.value = formatDate(thirtyDaysAgo));
        endDateInputs.forEach(input => input.value = formatDate(today));
    }

    function initializeCharts() {
        // Initialize empty charts with no data
        createEmptyChart('coordinatorPerformanceChart');
        createEmptyChart('technicalCoordinatorChart');
        createEmptyChart('inspectorPerformanceChart');
        // Use our new function for the comparison chart
        initializeComparisonChart();
        // Initialize empty summary tables
        displayEmptyState('coordinatorPerformanceChart', 'Select a coordinator and time period to view data');
        displayEmptyState('technicalCoordinatorChart', 'Select a technical coordinator and time period to view data');
        displayEmptyState('inspectorPerformanceChart', 'Select an inspector and time period to view data');
        // Create empty tables
        initializeEmptySummaryTable('coordinatorSummaryTable');
        initializeEmptySummaryTable('technicalSummaryTable');
        initializeEmptySummaryTable('inspectorSummaryTable');
    }

    function createEmptyChart(chartId) {
        const ctx = document.getElementById(chartId).getContext('2d');
        return new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'No data selected',
                    data: [],
                    backgroundColor: [],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        },
                        grid: {
                            display: true,
                            drawBorder: false,
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    function displayEmptyState(chartId, message) {
        const chartCanvas = document.getElementById(chartId);
        const container = chartCanvas.parentElement;

        // Create message container if it doesn't exist
        let emptyState = container.querySelector('.bd-empty-state');
        if (!emptyState) {
            emptyState = document.createElement('div');
            emptyState.className = 'bd-empty-state';
            container.appendChild(emptyState);
        }

        emptyState.innerHTML = `
            <div class="bd-empty-state-icon">
                <i class="fas fa-chart-bar"></i>
            </div>
            <div class="bd-empty-state-text">${message}</div>
        `;

        // Style the empty state
        emptyState.style.position = 'absolute';
        emptyState.style.top = '50%';
        emptyState.style.left = '50%';
        emptyState.style.transform = 'translate(-50%, -50%)';
        emptyState.style.textAlign = 'center';
        emptyState.style.color = '#858796';
        emptyState.style.fontSize = '1.2rem';
        emptyState.style.width = '100%';
        emptyState.style.zIndex = '10';

        // Style the chart canvas to be lighter
        chartCanvas.style.opacity = '0.3';
    }

    function removeEmptyState(chartId) {
        const chartCanvas = document.getElementById(chartId);
        const container = chartCanvas.parentElement;
        const emptyState = container.querySelector('.bd-empty-state');

        if (emptyState) {
            container.removeChild(emptyState);
        }

        // Restore chart opacity
        chartCanvas.style.opacity = '1';
    }

    function initializeEmptySummaryTable(tableId) {
        const table = document.getElementById(tableId);
        const tbody = table.querySelector('tbody');
        tbody.innerHTML = '';

        // Add a single row with a message
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.colSpan = 4;
        cell.textContent = 'No data available. Make selections above to view performance metrics.';
        cell.style.textAlign = 'center';
        cell.style.padding = '20px';
        cell.style.color = '#858796';

        row.appendChild(cell);
        tbody.appendChild(row);
    }

    function updateSummaryTable(tableId, chartData, totalInspections) {
        const table = document.getElementById(tableId);
        const tbody = table.querySelector('tbody');
        tbody.innerHTML = '';

        // Use provided total or calculate if not provided
        const total = totalInspections || chartData.datasets[0].data.reduce((sum, value) => sum + value, 0);

        // Create rows for each data point
        chartData.labels.forEach((label, index) => {
            const value = chartData.datasets[0].data[index];
            const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0.0';

            // Generate trend indicator (sample logic - would be replaced with actual trend data)
            let trendIcon, trendClass;
            if (index % 3 === 0) {
                trendIcon = 'fa-arrow-up';
                trendClass = 'bd-trend-up';
            } else if (index % 3 === 1) {
                trendIcon = 'fa-arrow-down';
                trendClass = 'bd-trend-down';
            } else {
                trendIcon = 'fa-arrows-alt-h';
                trendClass = 'bd-trend-neutral';
            }

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${label}</td>
                <td>${value.toLocaleString()}</td>
                <td>${percentage}%</td>
                <td class="${trendClass}"><i class="fas ${trendIcon}"></i></td>
            `;

            tbody.appendChild(row);
        });
    }

    // Period change handlers
    function handleCoordinatorPeriodChange() {
        const periodSelect = document.getElementById('coordinatorPeriodSelect');
        const customRangeContainer = document.getElementById('coordinatorCustomRangeContainer');

        if (periodSelect.value === 'custom') {
            customRangeContainer.style.display = 'block';
        } else {
            customRangeContainer.style.display = 'none';
            updateCoordinatorChartWithPeriod(periodSelect.value);
        }
    }

    function handleTechnicalPeriodChange() {
        const periodSelect = document.getElementById('technicalPeriodSelect');
        const customRangeContainer = document.getElementById('technicalCustomRangeContainer');

        if (periodSelect.value === 'custom') {
            customRangeContainer.style.display = 'block';
        } else {
            customRangeContainer.style.display = 'none';
            updateTechnicalChartWithPeriod(periodSelect.value);
        }
    }

    function handleInspectorPeriodChange() {
        const periodSelect = document.getElementById('inspectorPeriodSelect');
        const customRangeContainer = document.getElementById('inspectorCustomRangeContainer');

        if (periodSelect.value === 'custom') {
            customRangeContainer.style.display = 'block';
        } else {
            customRangeContainer.style.display = 'none';
            updateInspectorChartWithPeriod(periodSelect.value);
        }
    }

    // Custom range handlers
    function applyCoordinatorCustomRange() {
        const startDate = document.getElementById('coordinatorStartDate').value;
        const endDate = document.getElementById('coordinatorEndDate').value;

        if (startDate && endDate) {
            updateCoordinatorChartWithDateRange(startDate, endDate);
        } else {
            showNotification('Please select both start and end dates', 'error');
        }
    }

    function applyTechnicalCustomRange() {
        const startDate = document.getElementById('technicalStartDate').value;
        const endDate = document.getElementById('technicalEndDate').value;

        if (startDate && endDate) {
            updateTechnicalChartWithDateRange(startDate, endDate);
        } else {
            showNotification('Please select both start and end dates', 'error');
        }
    }

    function applyInspectorCustomRange() {
        const startDate = document.getElementById('inspectorStartDate').value;
        const endDate = document.getElementById('inspectorEndDate').value;

        if (startDate && endDate) {
            updateInspectorChartWithDateRange(startDate, endDate);
        } else {
            showNotification('Please select both start and end dates', 'error');
        }
    }

    // Update chart with period
    function updateCoordinatorChartWithPeriod(period) {
        const selectedCoordinator = document.getElementById('coordinatorSelect').value;

        if (selectedCoordinator) {
            fetchCoordinatorMetricData(selectedCoordinator, period);
        }
    }

    function updateTechnicalChartWithPeriod(period) {
        const selectedTechCoordinator = document.getElementById('technicalCoordinatorSelect').value;

        if (selectedTechCoordinator) {
            fetchTechnicalMetricData(selectedTechCoordinator, period);
        }
    }

    function updateInspectorChartWithPeriod(period) {
        const selectedInspector = document.getElementById('inspectorSelect').value;

        if (selectedInspector) {
            fetchInspectorMetricData(selectedInspector, period);
        }
    }

    // Update chart with date range
    function updateCoordinatorChartWithDateRange(startDate, endDate) {
        const selectedCoordinator = document.getElementById('coordinatorSelect').value;

        if (selectedCoordinator) {
            fetchCoordinatorDateRangeData(selectedCoordinator, startDate, endDate);
        } else {
            showNotification('Please select a coordinator first', 'warning');
        }
    }

    function updateTechnicalChartWithDateRange(startDate, endDate) {
        const selectedTechCoordinator = document.getElementById('technicalCoordinatorSelect').value;

        if (selectedTechCoordinator) {
            fetchTechnicalDateRangeData(selectedTechCoordinator, startDate, endDate);
        } else {
            showNotification('Please select a technical coordinator first', 'warning');
        }
    }

    function updateInspectorChartWithDateRange(startDate, endDate) {
        const selectedInspector = document.getElementById('inspectorSelect').value;

        if (selectedInspector) {
            fetchInspectorDateRangeData(selectedInspector, startDate, endDate);
        } else {
            showNotification('Please select an inspector first', 'warning');
        }
    }

    // Handler for individual selection
    function handleCoordinatorChange(selectElement) {
        const selectedCoordinatorEmail = selectElement.value;
        const period = document.getElementById('coordinatorPeriodSelect').value;

        if (!selectedCoordinatorEmail) return;

        // Remove empty state and show loading
        removeEmptyState('coordinatorPerformanceChart');
        showLoadingIndicator('coordinatorPerformanceChart');

        fetchCoordinatorMetricData(selectedCoordinatorEmail, period);

        // Update comparison chart if needed
        updateComparisonChart();
    }

    function handleTechnicalCoordinatorChange(selectElement) {
        const selectedTechnicalCoordinator = selectElement.value;
        const period = document.getElementById('technicalPeriodSelect').value;

        if (!selectedTechnicalCoordinator) return;

        // Remove empty state and show loading
        removeEmptyState('technicalCoordinatorChart');
        showLoadingIndicator('technicalCoordinatorChart');

        fetchTechnicalMetricData(selectedTechnicalCoordinator, period);

        // Update comparison chart if needed
        updateComparisonChart();
    }

    function handleInspectorChange(selectElement) {
        const selectedInspector = selectElement.value;
        const period = document.getElementById('inspectorPeriodSelect').value;

        if (!selectedInspector) return;

        // Remove empty state and show loading
        removeEmptyState('inspectorPerformanceChart');
        showLoadingIndicator('inspectorPerformanceChart');

        fetchInspectorMetricData(selectedInspector, period);

        // Update comparison chart if needed
        updateComparisonChart();
    }

    // Update the fetch functions to match your API endpoints
    function fetchCoordinatorMetricData(coordinatorEmail, period) {
        showLoadingIndicator('coordinatorPerformanceChart');

        fetch(`/business/coordinator-stats/${encodeURIComponent(coordinatorEmail)}/${encodeURIComponent(period)}`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            hideLoadingIndicator('coordinatorPerformanceChart');
            updateRoleChartDisplay('coordinator', data);
             if (hasMeaningfulInspectionData(data)) {
            // Add highlight animation
            const totalDisplay = document.getElementById('coordinatorTotalDisplay');
            if (totalDisplay) {
                totalDisplay.classList.add('bd-total-highlight');
                setTimeout(() => totalDisplay.classList.remove('bd-total-highlight'), 1500);
            }
            showNotification('Coordinator data updated successfully', 'success');
            }
        })
        .catch(error => {
            hideLoadingIndicator('coordinatorPerformanceChart');
            console.error('Error:', error);
            showNotification('Failed to fetch coordinator data. Please try again.', 'error');
        });
    }

    function fetchTechnicalMetricData(techCoordinatorId, period) {
        showLoadingIndicator('technicalCoordinatorChart');

        fetch(`/business/technical-coordinator-stats/${encodeURIComponent(techCoordinatorId)}/${encodeURIComponent(period)}`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            hideLoadingIndicator('technicalCoordinatorChart');
            updateRoleChartDisplay('technical', data);
             if (hasMeaningfulInspectionData(data)) {
                // Add highlight animation
            const totalDisplay = document.getElementById('techCoordinatorTotalDisplay');
            if (totalDisplay) {
                totalDisplay.classList.add('bd-total-highlight');
                setTimeout(() => totalDisplay.classList.remove('bd-total-highlight'), 1500);
            }
            showNotification('Technical coordinator data updated successfully', 'success');
            }
        })
        .catch(error => {
            hideLoadingIndicator('technicalCoordinatorChart');
            console.error('Error:', error);
            showNotification('Failed to fetch technical coordinator data. Please try again.', 'error');
        });
    }

    function fetchInspectorMetricData(inspectorEmail, period) {
        showLoadingIndicator('inspectorPerformanceChart');

        fetch(`/business/inspector-stats/${encodeURIComponent(inspectorEmail)}/${encodeURIComponent(period)}`, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            hideLoadingIndicator('inspectorPerformanceChart');
            updateRoleChartDisplay('inspector', data);
             if (hasMeaningfulInspectionData(data)) {
               // Add highlight animation
            const totalDisplay = document.getElementById('inspectorTotalDisplay');
            if (totalDisplay) {
                totalDisplay.classList.add('bd-total-highlight');
                setTimeout(() => totalDisplay.classList.remove('bd-total-highlight'), 1500);
            }
            showNotification('Inspector data updated successfully', 'success');
            }
        })
        .catch(error => {
            hideLoadingIndicator('inspectorPerformanceChart');
            console.error('Error:', error);
            showNotification('Failed to fetch inspector data. Please try again.', 'error');
        });
    }

    function hasMeaningfulInspectionData(data) {
        return data.totalInspections > 0 ||
               data.newInspections > 0 ||
               data.completedInspections > 0 ||
               data.ongoingInspections > 0 ||
               data.rejectedInspections > 0;
    }

    function updateRoleChartDisplay(roleType, data) {
        // Chart ID determination remains the same
        let chartId;
        if (roleType === 'technical') {
            chartId = 'technicalCoordinatorChart';
        } else {
		            chartId = `${roleType}PerformanceChart`;
        }
        const tableId = `${roleType}SummaryTable`;

        // Get the selected name from the dropdown
        let selectedName = "";
        if (roleType === 'coordinator') {
            const select = document.getElementById('coordinatorSelect');
            selectedName = select.options[select.selectedIndex].text;
        } else if (roleType === 'technical') {
            const select = document.getElementById('technicalCoordinatorSelect');
            selectedName = select.options[select.selectedIndex].text;
        } else if (roleType === 'inspector') {
            const select = document.getElementById('inspectorSelect');
            selectedName = select.options[select.selectedIndex].text;
        }

        // Create or update total inspections display
        const panelId = `${roleType === 'technical' ? 'technical' : roleType}-chart-panel`;
        let totalDisplayEl = document.getElementById(`${roleType}TotalDisplay`);

        if (!totalDisplayEl) {
            const chartContainer = document.getElementById(chartId).parentElement;
            totalDisplayEl = document.createElement('div');
            totalDisplayEl.id = `${roleType}TotalDisplay`;
            totalDisplayEl.className = 'bd-total-inspections-display';
            chartContainer.insertBefore(totalDisplayEl, chartContainer.firstChild);
        }

        // Format period text
        const periodText = formatPeriodText(data.period);

      // Update the total display
totalDisplayEl.innerHTML = `
    <div class="bd-total-header">
        <h3>${selectedName}</h3>
        <span class="bd-period-label">${periodText}</span>
    </div>
    <div class="bd-total-value">
        <span class="bd-total-number">${data.totalInspections}</span>
        <span class="bd-total-label">Total Inspections</span>
    </div>
    <div class="bd-metrics-breakdown">
        <div class="bd-metric-item">
            <span class="bd-metric-value">${data.newInspections || 0}</span>
            <span class="bd-metric-label">New</span>
        </div>
        <div class="bd-metric-item">
            <span class="bd-metric-value">${data.ongoingInspections || 0}</span>
            <span class="bd-metric-label">Ongoing</span>
        </div>
        <div class="bd-metric-item">
            <span class="bd-metric-value">${data.completedInspections || 0}</span>
            <span class="bd-metric-label">Awarded</span>
        </div>
        <div class="bd-metric-item">
            <span class="bd-metric-value">${data.rejectedInspections || 0}</span>
            <span class="bd-metric-label">Rejected</span>
        </div>
    </div>
`;

        const chart = Chart.getChart(chartId);
        if (!chart) {
            console.error(`Chart not found with ID: ${chartId}`);
            return;
        }

        // Chart data for the status breakdown
        const labels = ['New', 'Ongoing', 'Awarded', 'Rejected'];
        const values = [
            data.newInspections || 0,
            data.ongoingInspections || 0,
            data.completedInspections || 0,
            data.rejectedInspections || 0
        ];

        // Create chartData
        const chartData = {
            labels: labels,
            datasets: [{
                label: 'Inspection Status',
                data: values,
                backgroundColor: [
                    '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'
                ]
            }]
        };

        const isAllZero = values.every(val => val === 0);
        if (isAllZero) {
            showNotification('No data available for selected filters', 'warning');
            displayNoDataMessage(chartId);
        } else {
            removeNoDataMessage(chartId);
            chart.data = chartData;
            chart.update();
        }

        // Update summary table with percentages based on the total
        updateSummaryTable(tableId, chartData, data.totalInspections);
    }

    // Function to display "No Data Available" message in the chart
    function displayNoDataMessage(chartId) {
        const chart = Chart.getChart(chartId);
        if (!chart) return;

        const chartCanvas = document.getElementById(chartId);

        // Remove any existing message
        removeNoDataMessage(chartId);

        // Create message container
        const noDataContainer = document.createElement('div');
        noDataContainer.className = 'bd-no-data-message';
        noDataContainer.innerHTML = `
            <div class="bd-no-data-icon">
                <i class="fas fa-chart-bar"></i>
            </div>
            <div class="bd-no-data-text">
                No data available for selected filters
            </div>
        `;

        // Position the message over the chart
        noDataContainer.style.position = 'absolute';
        noDataContainer.style.top = '50%';
        noDataContainer.style.left = '50%';
        noDataContainer.style.transform = 'translate(-50%, -50%)';
        noDataContainer.style.textAlign = 'center';
        noDataContainer.style.color = '#858796';
        noDataContainer.style.fontSize = '1.2rem';
        noDataContainer.style.width = '100%';
        noDataContainer.style.zIndex = '10';

        // Make chart lighter to indicate no data
        chartCanvas.style.opacity = '0.5';

        // Add to parent container
        chartCanvas.parentElement.appendChild(noDataContainer);

        // Still update chart with empty data to maintain structure
        chart.data.datasets[0].data = [0, 0, 0, 0];
        chart.update();
    }

    // Function to remove "No Data Available" message
    function removeNoDataMessage(chartId) {
        const chartCanvas = document.getElementById(chartId);
        const container = chartCanvas.parentElement;
        const existingMessage = container.querySelector('.bd-no-data-message');

        if (existingMessage) {
            container.removeChild(existingMessage);
        }

        // Restore chart opacity
        chartCanvas.style.opacity = '1';
    }

    // Helper function to format period text
    function formatPeriodText(period) {
        switch(period) {
            case 'WEEK': return 'Last 7 Days';
            case 'MONTH': return 'Last 30 Days';
            case 'QUARTER': return 'Last Quarter';
            case 'YEAR': return 'Year to Date';
            case 'CUSTOM': return 'Custom Range';
            default: return period;
        }
    }

    function exportCoordinatorData(format) {
        const coordinatorSelect = document.getElementById('coordinatorSelect');
        const coordinatorEmail = coordinatorSelect.value;
        const coordinatorName = coordinatorSelect.selectedOptions[0]?.text || 'report';

        const period = document.getElementById('coordinatorPeriodSelect').value;

        if (!coordinatorEmail) {
            showNotification('Please select a coordinator before exporting.', 'warning');
            return;
        }

        const endpoint = `/business/coordinator-report/${coordinatorEmail}/${period}/${format}`;
        const filename = `${coordinatorName.replace(/\s+/g, '_')}_report.${format === 'pdf' ? 'pdf' : 'xlsx'}`;

        fetch(endpoint)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Error: ${response.status}`);
                }
                return response.blob();
            })
            .then(blob => {
                const link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(link.href);

                showNotification(`${format.toUpperCase()} downloaded successfully.`, 'success');
            })
            .catch(error => {
                console.error('Download failed:', error);
                showNotification(`Failed to export ${format.toUpperCase()} report.`, 'error');
            });
    }

    function exportTechnicalData(format) {
        const selectedTechCoordinator = document.getElementById('technicalCoordinatorSelect').value;

        if (!selectedTechCoordinator) {
            showNotification('Please select a technical coordinator before exporting data', 'warning');
            return;
        }

        const coordinatorName = document.getElementById('technicalCoordinatorSelect').options[document.getElementById('technicalCoordinatorSelect').selectedIndex].text;

        const period = document.getElementById('technicalPeriodSelect').value;

        showNotification(`Exporting ${format.toUpperCase()} report for ${coordinatorName}...`, 'info');

        // Simulate export process
        setTimeout(() => {
            showNotification(`${format.toUpperCase()} report for ${coordinatorName} has been generated successfully`, 'success');
        }, 1500);
    }

    function exportInspectorData(format) {
        const selectedInspector = document.getElementById('inspectorSelect').value;

        if (!selectedInspector) {
            showNotification('Please select an inspector before exporting data', 'warning');
            return;
        }

        const inspectorName = document.getElementById('inspectorSelect').options[document.getElementById('inspectorSelect').selectedIndex].text;

        const period = document.getElementById('inspectorPeriodSelect').value;

        showNotification(`Exporting ${format.toUpperCase()} report for ${inspectorName}...`, 'info');

        // Simulate export process
        setTimeout(() => {
            showNotification(`${format.toUpperCase()} report for ${inspectorName} has been generated successfully`, 'success');
        }, 1500);
    }

    // Utility functions
    function showLoadingIndicator(chartId) {
        const chartContainer = document.getElementById(chartId).parentElement;

        // Create loading overlay if it doesn't exist
        if (!chartContainer.querySelector('.bd-loading-overlay')) {
            const loadingOverlay = document.createElement('div');
            loadingOverlay.className = 'bd-loading-overlay';
            loadingOverlay.innerHTML = `
                <div class="bd-loading-spinner">
                    <i class="fas fa-circle-notch fa-spin"></i>
                </div>
                <div class="bd-loading-text">Loading data...</div>
            `;

            chartContainer.style.position = 'relative';
            chartContainer.appendChild(loadingOverlay);
        } else {
            chartContainer.querySelector('.bd-loading-overlay').style.display = 'flex';
        }
    }

    function hideLoadingIndicator(chartId) {
        const chartContainer = document.getElementById(chartId).parentElement;
        const loadingOverlay = chartContainer.querySelector('.bd-loading-overlay');

        if (loadingOverlay) {
            loadingOverlay.style.display = 'none';
        }
    }

    function showNotification(message, type = 'info') {
        // Check if notification container exists, if not create it
        let notificationContainer = document.getElementById('bd-notification-container');
        if (!notificationContainer) {
            notificationContainer = document.createElement('div');
            notificationContainer.id = 'bd-notification-container';
            document.body.appendChild(notificationContainer);
        }

        // Create notification element
        const notification = document.createElement('div');
        notification.className = `bd-notification bd-notification-${type}`;

        // Set icon based on type
        let icon;
        switch (type) {
            case 'success':
                icon = 'fa-check-circle';
                break;
            case 'error':
                icon = 'fa-times-circle';
                break;
            case 'warning':
                icon = 'fa-exclamation-triangle';
                break;
            default:
                icon = 'fa-info-circle';
        }

        notification.innerHTML = `
            <div class="bd-notification-icon">
                <i class="fas ${icon}"></i>
            </div>
            <div class="bd-notification-content">
                ${message}
            </div>
            <div class="bd-notification-close">
                <i class="fas fa-times"></i>
            </div>
        `;

        // Add to container
        notificationContainer.appendChild(notification);

        // Add event listener to close button
        notification.querySelector('.bd-notification-close').addEventListener('click', function() {
            notification.classList.add('bd-notification-hiding');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        });

        // Auto-remove after delay
        setTimeout(() => {
            if (notification.parentNode) {
                notification.classList.add('bd-notification-hiding');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }, 5000);
    }

    function generateChartColors(count) {
        const colorPalette = [
            '#4e73df', // Primary blue
            '#1cc88a', // Success green
            '#36b9cc', // Info teal
            '#f6c23e', // Warning yellow
            '#e74a3b', // Danger red
            '#6f42c1', // Purple
            '#fd7e14', // Orange
            '#20c9a6', // Cyan
            '#858796', // Gray
            '#5a5c69'  // Dark Gray
        ];
        let colors = [];
        // If we need more colors than in our palette, generate them
        if (count <= colorPalette.length) {
            colors = colorPalette.slice(0, count);
        } else {
            for (let i = 0; i < count; i++) {
                if (i < colorPalette.length) {
                    colors.push(colorPalette[i]);
                } else {
                    // Generate random colors for additional items
                    const hue = i * (360 / count);
                    colors.push(`hsl(${hue}, 70%, 60%)`);
                }
            }
        }

        return colors;
    }

    function updateComparisonChart() {
        const comparisonChart = Chart.getChart('comparisonChart');
        if (!comparisonChart) {
            console.error('Comparison chart not found');
            return;
        }
        // Get selected individuals
        const selectedCoordinator = document.getElementById('coordinatorSelect').value;
        const selectedTechnical = document.getElementById('technicalCoordinatorSelect').value;
        const selectedInspector = document.getElementById('inspectorSelect').value;

        // Get selected individual names
        let coordinatorName = "";
        let technicalName = "";
        let inspectorName = "";

        if (selectedCoordinator) {
            const select = document.getElementById('coordinatorSelect');
            coordinatorName = select.options[select.selectedIndex].text;
        }
        if (selectedTechnical) {
            const select = document.getElementById('technicalCoordinatorSelect');
            technicalName = select.options[select.selectedIndex].text;
        }
        if (selectedInspector) {
            const select = document.getElementById('inspectorSelect');
            inspectorName = select.options[select.selectedIndex].text;
        }

        if (!selectedCoordinator && !selectedTechnical && !selectedInspector) {
            // No selections made - display empty state
            comparisonChart.data.labels = ['No data available'];
            comparisonChart.data.datasets = [{
                label: 'Make selections above to compare performance',
                data: [0],
                borderColor: '#858796',
                backgroundColor: 'rgba(133, 135, 150, 0.2)',
                borderWidth: 2,
                pointRadius: 0
            }];
            comparisonChart.update();
            return;
        }

        // Set up data structure
        const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const datasets = [];

        // Generate sample data for comparison (in real implementation, fetch from API)
        if (selectedCoordinator) {
            datasets.push({
                label: `${coordinatorName} (Coordinator)`,
                data: generateRandomData(12, 10, 50),
                borderColor: '#4e73df',
                backgroundColor: 'rgba(78, 115, 223, 0.05)',
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                pointBackgroundColor: '#4e73df',
                pointBorderColor: '#fff',
                pointHoverRadius: 5,
                pointHoverBackgroundColor: '#4e73df',
                pointHoverBorderColor: '#fff',
                fill: false
            });
        }

        if (selectedTechnical) {
            datasets.push({
                label: `${technicalName} (Technical)`,
                data: generateRandomData(12, 10, 40),
                borderColor: '#1cc88a',
                backgroundColor: 'rgba(28, 200, 138, 0.05)',
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                pointBackgroundColor: '#1cc88a',
                pointBorderColor: '#fff',
                pointHoverRadius: 5,
                pointHoverBackgroundColor: '#1cc88a',
                pointHoverBorderColor: '#fff',
                fill: false
            });
        }

        if (selectedInspector) {
            datasets.push({
                label: `${inspectorName} (Inspector)`,
                data: generateRandomData(12, 10, 45),
                borderColor: '#36b9cc',
                backgroundColor: 'rgba(54, 185, 204, 0.05)',
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                pointBackgroundColor: '#36b9cc',
                pointBorderColor: '#fff',
                pointHoverRadius: 5,
                pointHoverBackgroundColor: '#36b9cc',
                pointHoverBorderColor: '#fff',
                fill: false
            });
        }

        // Add team average for comparison
        datasets.push({
            label: 'Team Average',
            data: generateRandomData(12, 15, 30),
            borderColor: '#858796',
            backgroundColor: 'rgba(133, 135, 150, 0.05)',
            borderWidth: 2,
            borderDash: [5, 5],
            tension: 0.3,
            pointRadius: 2,
            pointBackgroundColor: '#858796',
            pointBorderColor: '#fff',
            pointHoverRadius: 4,
            pointHoverBackgroundColor: '#858796',
            pointHoverBorderColor: '#fff',
            fill: false
        });

        // Update chart
        comparisonChart.data.labels = labels;
        comparisonChart.data.datasets = datasets;
        comparisonChart.update();

        // Add title or annotation if needed
        comparisonChart.options.plugins.title = {
            display: true,
            text: 'Individual vs. Team Performance Comparison',
            font: {
                size: 16,
                weight: 'bold'
            },
            padding: {
                top: 10,
                bottom: 20
            }
        };

        comparisonChart.update();
    }

    // Helper function to generate random data for demonstration
    function generateRandomData(count, min, max) {
        const data = [];
        for (let i = 0; i < count; i++) {
            data.push(Math.floor(Math.random() * (max - min + 1)) + min);
        }
        return data;
    }

    // Initialize the comparison chart with empty data
    function initializeComparisonChart() {
        const ctx = document.getElementById('comparisonChart').getContext('2d');
        return new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Select users above to compare performance',
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    borderColor: '#858796',
                    backgroundColor: 'rgba(133, 135, 150, 0.1)',
                    borderWidth: 1,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Inspections Completed'
                        },
                        grid: {
                            display: true,
                            drawBorder: false,
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            boxWidth: 12,
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#5a5c69',
                        bodyColor: '#5a5c69',
                        borderColor: '#e3e6f0',
                        borderWidth: 1,
                        cornerRadius: 4,
                        displayColors: true,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y + ' inspections';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    // Add event listeners after DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Set up listeners for individual select changes
        document.getElementById('coordinatorSelect').addEventListener('change', function() {
            handleCoordinatorChange(this);
            updateComparisonChart();
        });
        document.getElementById('technicalCoordinatorSelect').addEventListener('change', function() {
            handleTechnicalCoordinatorChange(this);
            updateComparisonChart();
        });
        document.getElementById('inspectorSelect').addEventListener('change', function() {
            handleInspectorChange(this);
            updateComparisonChart();
        });

        // Also update comparison chart when period changes
        document.getElementById('coordinatorPeriodSelect').addEventListener('change', updateComparisonChart);
        document.getElementById('technicalPeriodSelect').addEventListener('change', updateComparisonChart);
        document.getElementById('inspectorPeriodSelect').addEventListener('change', updateComparisonChart);
    });

    /*]]>*/
</script>
<style>
    /* Main Container Styles */
    .bd-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    .bd-dashboard-container {
        background-color: #f8f9fc;
        border-radius: 8px;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        padding: 20px;
    }

    .bd-dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 20px;
        border-bottom: 1px solid #e3e6f0;
        margin-bottom: 20px;
    }

    .bd-dashboard-title {
        font-size: 24px;
        font-weight: 700;
        color: #4e73df;
    }

    .bd-date-filter {
        font-size: 16px;
        color: #858796;
    }

    /* Stats Grid Styles */
    .bd-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .bd-stat-card {
        background-color: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    .bd-stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .bd-stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        cursor: pointer;
        border-bottom: 1px solid #f1f1f1;
    }

    .bd-stat-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        color: #fff;
    }

    .bd-inspection-icon {
        background-color: #4e73df;
    }

    .bd-employee-icon {
        background-color: #1cc88a;
    }

    .bd-client-icon {
        background-color: #36b9cc;
    }

    .bd-inspector-icon {
        background-color: #f6c23e;
    }

    .bd-stat-title {
        font-size: 16px;
        font-weight: 600;
        flex: 1;
        margin-left: 15px;
    }

    .bd-dropdown-icon {
        font-size: 14px;
        color: #858796;
        transition: transform 0.3s ease;
    }

    .bd-dropdown-icon.active {
        transform: rotate(180deg);
    }

    .bd-stat-summary {
        padding: 15px;
        text-align: center;
        background-color: #fafafa;
    }

    .bd-summary-label {
        font-size: 14px;
        color: #858796;
        margin-bottom: 5px;
    }

    .bd-summary-value {
        font-size: 24px;
        font-weight: 700;
        color: #5a5c69;
    }

    .bd-stat-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
    }

    .bd-stat-content.expanded {
        max-height: 500px;
    }

    .bd-stat-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 15px;
        border-top: 1px solid #f1f1f1;
    }

    .bd-stat-label {
        font-size: 14px;
        color: #858796;
    }

    .bd-stat-value {
        font-weight: 600;
        color: #5a5c69;
    }

    /* Chart Section Styles */
    .bd-chart-section, .bd-trends-section {
        margin-bottom: 30px;
    }

    .bd-section-header {
        margin-bottom: 20px;
    }

    .bd-section-header h2 {
        font-size: 20px;
        font-weight: 700;
        color: #4e73df;
        margin-bottom: 5px;
    }

    .bd-section-header p {
        font-size: 14px;
        color: #858796;
    }

    .bd-tab-navigation {
        display: flex;
        border-bottom: 1px solid #e3e6f0;
        margin-bottom: 20px;
    }
.bd-total-inspections-display {
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    background-color: #f8f9fc;
    border-radius: 0.35rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 0.15rem 1.75rem rgba(58, 59, 69, 0.15);
    transition: all 0.3s ease;
}

.bd-total-inspections-display .bd-total-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.bd-total-inspections-display .bd-total-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: #5a5c69;
}

.bd-total-inspections-display .bd-period-label {
    font-size: 0.9rem;
    color: #858796;
    background-color: rgba(78, 115, 223, 0.1);
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
}

.bd-total-inspections-display .bd-total-value {
    display: flex;
    align-items: baseline;
}

.bd-total-inspections-display .bd-total-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #4e73df;
    margin-right: 1rem;
}

.bd-total-inspections-display .bd-total-label {
    font-size: 1.1rem;
    color: #858796;
}

/* Add animation for when total changes */
@keyframes highlight {
    0% { background-color: #f8f9fc; }
    50% { background-color: rgba(78, 115, 223, 0.2); }
    100% { background-color: #f8f9fc; }
}

.bd-total-highlight {
    animation: highlight 1.5s ease;
}
    .bd-tab-button {
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 600;
        color: #858796;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .bd-tab-button:hover {
        color: #4e73df;
    }

    .bd-tab-button.active {
        color: #4e73df;
        border-bottom-color: #4e73df;
    }

    .bd-chart-panel {
        display: none;
    }

    .bd-chart-panel.active {
        display: block;
    }

    .bd-chart-card {
        background-color: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin-bottom: 20px;
    }

    .bd-chart-controls-container {
        margin-bottom: 20px;
    }

    .bd-chart-header {
        font-size: 18px;
        font-weight: 700;
        color: #5a5c69;
        margin-bottom: 15px;
    }

    .bd-filters-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: flex-end;
    }

    .bd-filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .bd-filter-group label {
        font-size: 13px;
        color: #858796;
    }

    .bd-select, .bd-period-select {
        min-width: 180px;
        padding: 8px 12px;
        border: 1px solid #e3e6f0;
        border-radius: 4px;
        font-size: 14px;
        color: #5a5c69;
        background-color: #fff;
    }

    .bd-primary-filter {
        flex: 1;
        min-width: 220px;
    }

    .bd-primary-select {
        width: 100%;
    }

    .bd-export-group {
        display: flex;
        flex-direction: row;
        gap: 8px;
        margin-left: auto;
    }
.bd-metrics-breakdown {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    border-top: 1px solid rgba(0,0,0,0.1);
    padding-top: 15px;
}

.bd-metric-item {
    text-align: center;
    flex: 1;
    padding: 0 10px;
    border-right: 1px solid rgba(0,0,0,0.1);
}

.bd-metric-item:last-child {
    border-right: none;
}

.bd-metric-value {
    display: block;
    font-size: 1.2rem;
    font-weight: 700;
    color: #4e73df;
}

.bd-metric-label {
    display: block;
    font-size: 0.8rem;
    color: #858796;
    margin-top: 5px;
}

/* Color coding for different metrics */
.bd-metric-item:nth-child(1) .bd-metric-value {
    color: #4e73df; /* New - blue */
}

.bd-metric-item:nth-child(2) .bd-metric-value {
    color: #1cc88a; /* Ongoing - green */
}

.bd-metric-item:nth-child(3) .bd-metric-value {
    color: #36b9cc; /* Awarded - teal */
}

.bd-metric-item:nth-child(4) .bd-metric-value {
    color: #f6c23e; /* Rejected - yellow */
}

/* Make the total display a bit more prominent */
.bd-total-inspections-display {
    background-color: #fff;
    border-radius: 0.35rem;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
}
    .bd-export-btn {
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        background-color: #f8f9fc;
        color: #5a5c69;
        border: 1px solid #e3e6f0;
        transition: all 0.2s ease;
    }

    .bd-export-btn:hover {
        background-color: #eaecf4;
    }

    .bd-export-btn i {
        margin-right: 5px;
    }

    .bd-custom-range {
        background-color: #f8f9fc;
        border: 1px solid #e3e6f0;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .bd-custom-range-content {
        display: flex;
        gap: 15px;
        align-items: flex-end;
    }

    .bd-date-input-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .bd-date-input-group label {
        font-size: 13px;
        color: #858796;
    }

    .bd-date-input-group input[type="date"] {
        padding: 8px 12px;
        border: 1px solid #e3e6f0;
        border-radius: 4px;
        font-size: 14px;
        color: #5a5c69;
    }

    .bd-filter-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 600;
        background-color: #4e73df;
        color: white;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .bd-filter-btn:hover {
        background-color: #2e59d9;
    }

    .bd-chart-container {
        position: relative;
        width: 100%;
        margin-bottom: 20px;
    }

    .bd-loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10;
    }

    .bd-loading-spinner {
        font-size: 36px;
        color: #4e73df;
        margin-bottom: 10px;
    }

    .bd-loading-text {
        font-size: 14px;
        color: #5a5c69;
    }

    .bd-data-summary {
        margin-top: 20px;
    }

    .bd-data-summary h3 {
        font-size: 16px;
        font-weight: 700;
        color: #5a5c69;
        margin-bottom: 15px;
    }

    .bd-data-table-container {
        overflow-x: auto;
    }

    .bd-data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .bd-data-table th,
    .bd-data-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e3e6f0;
    }

    .bd-data-table th {
        font-size: 14px;
        font-weight: 600;
        color: #4e73df;
        background-color: #f8f9fc;
    }

    .bd-data-table td {
        font-size: 14px;
        color: #5a5c69;
    }

    .bd-trend-up {
        color: #1cc88a;
    }

    .bd-trend-down {
        color: #e74a3b;
    }

    .bd-trend-neutral {
        color: #f6c23e;
    }

    .bd-trends-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }

    /* Notification Styles */
    #bd-notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 300px;
        max-width: 90%;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .bd-notification {
        background-color: white;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        padding: 15px;
        align-items: center;
        animation: slideIn 0.3s forwards;
        overflow: hidden;
    }

    .bd-notification-hiding {
        animation: slideOut 0.3s forwards;
    }

    .bd-notification-icon {
        font-size: 20px;
        margin-right: 12px;
    }

    .bd-notification-success .bd-notification-icon {
        color: #1cc88a;
    }

    .bd-notification-error .bd-notification-icon {
        color: #e74a3b;
    }

    .bd-notification-warning .bd-notification-icon {
        color: #f6c23e;
    }

    .bd-notification-info .bd-notification-icon {
        color: #36b9cc;
    }

    .bd-notification-content {
        flex: 1;
        font-size: 14px;
        color: #5a5c69;
    }

    .bd-notification-close {
        margin-left: 12px;
        cursor: pointer;
        color: #858796;
        font-size: 14px;
        transition: color 0.2s ease;
    }

    .bd-notification-close:hover {
        color: #5a5c69;
    }

    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }

    /* Responsive Adjustments */
    @media (max-width: 992px) {
        .bd-filters-container {
            flex-direction: column;
            align-items: stretch;
        }

        .bd-export-group {
            margin-left: 0;
            justify-content: flex-end;
        }
    }

    @media (max-width: 768px) {
        .bd-dashboard-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .bd-date-filter {
            margin-top: 10px;
        }

        .bd-custom-range-content {
            flex-direction: column;
            align-items: stretch;
        }

        .bd-filter-btn {
            margin-top: 10px;
        }
    }
    .bd-no-data-message {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    background-color: rgba(255, 255, 255, 0.8);
    border-radius: 0.5rem;
}

.bd-no-data-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: #d1d3e2;
}

.bd-no-data-text {
    font-weight: 500;
}
</style>
</body>
</html>