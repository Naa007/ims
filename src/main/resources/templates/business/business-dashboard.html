<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!-- Head -->
<head th:replace="fragments/head :: head('Business Dashboard')"></head>
<body>
<!-- Header -->
<header th:replace="fragments/header :: header"></header>

<main class="bd-container">
    <div class="bd-dashboard-container">

        <!-- IISPL Performance Charts Section -->
        <h4 class="section-header">
            <div style="display: flex; align-items: center; justify-content: flex-start;">
                <i class="fas fa-chart-line me-2"></i>IISPL Performance Matrices
            </div>
        </h4>

        <div class="bd-chart-section">

            <!-- Tab Navigation for Individual Charts -->
            <div class="bd-tab-navigation">
                <button class="bd-tab-button active" data-target="all-chart-panel">All</button>
                <button class="bd-tab-button" data-target="coordinator-chart-panel">Coordinators</button>
                <button class="bd-tab-button" data-target="technical-chart-panel">Technical Coordinators</button>
                <button class="bd-tab-button" data-target="inspector-chart-panel">Inspectors</button>
            </div>

            <!-- Chart Panels -->
            <div class="bd-chart-panels">
                <!-- All Panel -->
                <div class="bd-chart-panel active" id="all-chart-panel">
                    <div class="bd-chart-card">
                        <div class="bd-performance-metrics-container" id="allPerformanceContainer">
                            <div class="bd-metrics-display">
                                <div class="bd-metrics-header">
                                    <h3>All Inspections</h3>
                                    <span class="bd-period-label">Current Status</span>
                                </div>
                                <div class="bd-metrics-total">
                                    <span class="bd-total-number" th:text="${inspectionStats['Total Inspections']}">0</span>
                                    <span class="bd-total-label">Total Inspections</span>
                                </div>
                                <div class="bd-metrics-breakdown">
                                    <div class="bd-metric-item">
                                        <span class="bd-metric-value" th:text="${inspectionStats['New']}">0</span>
                                        <span class="bd-metric-label">New</span>
                                    </div>
                                    <div class="bd-metric-item">
                                        <span class="bd-metric-value" th:text="${inspectionStats['Ongoing']}">0</span>
                                        <span class="bd-metric-label">Ongoing</span>
                                    </div>
                                    <div class="bd-metric-item">
                                        <span class="bd-metric-value" th:text="${inspectionStats['Awarded']}">0</span>
                                        <span class="bd-metric-label">Awarded</span>
                                    </div>
                                    <div class="bd-metric-item">
                                        <span class="bd-metric-value" th:text="${inspectionStats['Rejected']}">0</span>
                                        <span class="bd-metric-label">Rejected</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Coordinator Panel -->
                <div class="bd-chart-panel" id="coordinator-chart-panel">
                    <div class="bd-chart-card">
                        <div class="bd-chart-controls-container">

                            <div class="bd-filters-container">

                                <!-- Primary Selector -->
                                <div class="bd-filter-group bd-primary-filter">

                                    <label for="coordinatorSelect">Select Coordinator:</label>
                                    <select class="bd-select bd-primary-select" id="coordinatorSelect"
                                            onchange="handleCoordinatorChange(this)">
                                        <option disabled selected value="">Choose a coordinator</option>
                                        <option th:each="coordinator : ${coordinatorsList}"
                                                th:text="${coordinator.empName}"
                                                th:value="${coordinator.email}">
                                        </option>
                                    </select>
                                </div>

                                <!-- Chart Period Selection -->
                                <div class="bd-filter-group">
                                    <label for="coordinatorPeriodSelect">Time Range:</label>
                                    <select class="bd-period-select" id="coordinatorPeriodSelect"
                                            onchange="handleCoordinatorPeriodChange()">
                                        <option value="week">Last 7 Days</option>
                                        <option selected value="month">Last 30 Days</option>
                                        <option value="custom">Custom Range</option>
                                    </select>

                                </div>

                                <!-- Custom Date Range Container -->
                                <div id="coordinatorCustomRangeContainer" style="display: none;">
                                    <div class="bd-custom-range-content">
                                        <div class="bd-date-input-group">
                                            <label for="coordinatorStartDate">From:</label>
                                            <input id="coordinatorStartDate" name="coordinatorStartDate" type="date">
                                        </div>
                                        <div class="bd-date-input-group">
                                            <label for="coordinatorEndDate">To:</label>
                                            <input id="coordinatorEndDate" name="coordinatorEndDate" type="date">
                                        </div>
                                        <button class="bd-filter-btn" onclick="applyCoordinatorCustomRange()" type="button">
                                            Apply
                                        </button>
                                    </div>
                                </div>

                                <!-- Export Options -->
                                <div class="bd-filter-group bd-export-group">
                                    <button class="bd-export-btn" onclick="exportCoordinatorData('pdf',event)">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                    <button class="bd-export-btn" onclick="exportCoordinatorData('excel',event)">
                                        <i class="fas fa-file-excel"></i> Excel
                                    </button>
                                </div>

                            </div>

                        </div>

                        <!-- Performance Metrics Container -->
                        <div class="bd-performance-metrics-container" id="coordinatorPerformanceContainer">
                            <div class="bd-empty-state">
                                <div class="bd-empty-state-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="bd-empty-state-text">Select a coordinator and time period to view data</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Technical Coordinator Panel -->
                <div class="bd-chart-panel" id="technical-chart-panel">
                    <div class="bd-chart-card">
                        <div class="bd-chart-controls-container">
                            <div class="bd-filters-container">
                                <!-- Primary Selector -->
                                <div class="bd-filter-group bd-primary-filter">
                                    <label for="technicalCoordinatorSelect">Select Technical Coordinator:</label>
                                    <select class="bd-select bd-primary-select" id="technicalCoordinatorSelect"
                                            onchange="handleTechnicalCoordinatorChange(this)">
                                        <option disabled selected value="">Choose a technical coordinator</option>
                                        <option th:each="technicalCoordinator : ${technicalCoordinatorsList}"
                                                th:text="${technicalCoordinator.empName}"
                                                th:value="${technicalCoordinator.empId}">
                                        </option>
                                    </select>
                                </div>

                                <!-- Chart Period Selection -->
                                <div class="bd-filter-group">
                                    <label for="technicalPeriodSelect">Time Range:</label>
                                    <select class="bd-period-select" id="technicalPeriodSelect"
                                            onchange="handleTechnicalPeriodChange()">
                                        <option value="week">Last 7 Days</option>
                                        <option selected value="month">Last 30 Days</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>

                                <!-- Custom Date Range Container -->
                                <div id="technicalCustomRangeContainer" style="display: none;">
                                    <div class="bd-custom-range-content">
                                        <div class="bd-date-input-group">
                                            <label for="technicalStartDate">From:</label>
                                            <input id="technicalStartDate" name="technicalStartDate" type="date">
                                        </div>
                                        <div class="bd-date-input-group">
                                            <label for="technicalEndDate">To:</label>
                                            <input id="technicalEndDate" name="technicalEndDate" type="date">
                                        </div>
                                        <button class="bd-filter-btn" onclick="applyTechnicalCustomRange()" type="button">
                                            Apply
                                        </button>
                                    </div>
                                </div>

                                <!-- Export Options -->
                                <div class="bd-filter-group bd-export-group">
                                    <button class="bd-export-btn" onclick="exportTechnicalData('pdf',event)">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                    <button class="bd-export-btn" onclick="exportTechnicalData('excel',event)">
                                        <i class="fas fa-file-excel"></i> Excel
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics Container -->
                        <div class="bd-performance-metrics-container" id="technicalCoordinatorContainer">
                            <div class="bd-empty-state">
                                <div class="bd-empty-state-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="bd-empty-state-text">Select a technical coordinator and time period to view data</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inspector Panel -->
                <div class="bd-chart-panel" id="inspector-chart-panel">
                    <div class="bd-chart-card">
                        <div class="bd-chart-controls-container">
                            <div class="bd-filters-container">
                                <!-- Primary Selector -->
                                <div class="bd-filter-group bd-primary-filter">
                                    <label for="inspectorSelect">Select Inspector:</label>
                                    <select class="bd-select bd-primary-select" id="inspectorSelect"
                                            onchange="handleInspectorChange(this)">
                                        <option disabled selected value="">Choose an inspector</option>
                                        <option th:each="inspector : ${inspectorsList}"
                                                th:text="${inspector.inspectorName}"
                                                th:value="${inspector.email}">
                                        </option>
                                    </select>
                                </div>

                                <!-- Chart Period Selection -->
                                <div class="bd-filter-group">
                                    <label for="inspectorPeriodSelect">Time Range:</label>
                                    <select class="bd-period-select" id="inspectorPeriodSelect"
                                            onchange="handleInspectorPeriodChange()">
                                        <option value="week">Last 7 Days</option>
                                        <option selected value="month">Last 30 Days</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                </div>

                                <!-- Custom Date Range Container -->
                                <div id="inspectorCustomRangeContainer" style="display: none;">
                                    <div class="bd-custom-range-content">
                                        <div class="bd-date-input-group">
                                            <label for="inspectorStartDate">From:</label>
                                            <input id="inspectorStartDate" name="inspectorStartDate" type="date">
                                        </div>
                                        <div class="bd-date-input-group">
                                            <label for="inspectorEndDate">To:</label>
                                            <input id="inspectorEndDate" name="inspectorEndDate" type="date">
                                        </div>
                                        <button class="bd-filter-btn" onclick="applyInspectorCustomRange()" type="button">
                                            Apply
                                        </button>
                                    </div>
                                </div>

                                <!-- Export Options -->
                                <div class="bd-filter-group bd-export-group">
                                    <button class="bd-export-btn" onclick="exportInspectorData('pdf',event)">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                    <button class="bd-export-btn" onclick="exportInspectorData('excel',event)">
                                        <i class="fas fa-file-excel"></i> Excel
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics Container -->
                        <div class="bd-performance-metrics-container" id="inspectorPerformanceContainer">
                            <div class="bd-empty-state">
                                <div class="bd-empty-state-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="bd-empty-state-text">Select an inspector and time period to view data</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- IISPL Performance Trends Section -->
        <div class="bd-trends-section">

            <h4 class="section-header">
                <div style="display: flex; align-items: center; justify-content: flex-start;">
                    <i class="fas fa-chart-line me-2"></i>IISPL Performance Trends
                </div>
            </h4>

            <div class="bd-trends-container">
                <div class="bd-trend-card">
                    <div class="bd-chart-container" id="comparisonChartContainer" style="position: relative; height:400px;">
                        <div class="bd-loading-overlay" id="comparisonChartLoader" style="display: none;">
                            <div class="bd-loading-spinner">
                                <i class="fas fa-circle-notch fa-spin"></i>
                            </div>
                            <div class="bd-loading-text">Loading data...</div>
                        </div>
                        <canvas id="comparisonChart"></canvas>
                    </div>

                </div>
            </div>
        </div>

        <!-- Enterprises Performance Analytics Section -->
        <h4 class="section-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; justify-content: flex-start;">
                    <i class="fas fa-chart-line me-2"></i>IISPL Data Analytics
                </div>
                <div class="bd-date-filter date">
                    <span th:text="${#temporals.format(#temporals.createNow(), 'MMMM dd, yyyy')}">April 14, 2025</span>
                </div>
            </div>
        </h4>

        <!-- Stats Grid -->
        <div class="bd-stats-grid">
            <!-- Inspection Stats Card -->
            <div class="bd-stat-card" th:if="${inspectionStats != null}">
                <div class="bd-stat-header" data-target="inspection-stats">
                    <div class="bd-stat-icon bd-inspection-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="bd-stat-title">Inspections</div>
                    <i class="fas fa-chevron-down bd-dropdown-icon"></i>
                </div>
                <div class="bd-stat-summary">
                    <div class="bd-summary-label">Total Inspections</div>
                    <div class="bd-summary-value" th:text="${inspectionStats['Total Inspections']}">0</div>
                </div>
                <div class="bd-stat-content" id="inspection-stats">
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">New</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['New']}">0</div>
                    </div>
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">Ongoing</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['Ongoing']}">0</div>
                    </div>
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">Awarded</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['Awarded']}">0</div>
                    </div>
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">Rejected</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['Rejected']}">0</div>
                    </div>
                    <div class="bd-stat-item">
                        <div class="bd-stat-label">Closed</div>
                        <div class="bd-stat-value" th:text="${inspectionStats['Closed']}">0</div>
                    </div>
                </div>
            </div>
            <!-- Employee Stats Card -->
            <div class="bd-stat-card" th:if="${employeeStats!= null}">
                <div class="bd-stat-header" data-target="employee-stats">
                    <div class="bd-stat-icon bd-employee-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="bd-stat-title">Employees</div>
                    <i class="fas fa-chevron-down bd-dropdown-icon"></i>
                </div>
                <div class="bd-stat-summary">
                    <div class="bd-summary-label">Total Employees</div>
                    <div class="bd-summary-value" th:text="${employeeStats['Total Employees']}">0</div>
                </div>
                <div class="bd-stat-content" id="employee-stats">
                    <div class="bd-stat-item" th:each="stat : ${employeeStats}"
                         th:if="${!stat.key.equals('Total Employees')}">
                        <div class="bd-stat-label" th:text="${stat.key}">Active Employees</div>
                        <div class="bd-stat-value" th:text="${stat.value}">0</div>
                    </div>
                </div>
            </div>

            <!-- Client Stats Card -->
            <div class="bd-stat-card" th:if="${clientStats != null}">
                <div class="bd-stat-header" data-target="client-stats">
                    <div class="bd-stat-icon bd-client-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="bd-stat-title">Clients</div>
                    <i class="fas fa-chevron-down bd-dropdown-icon"></i>
                </div>
                <div class="bd-stat-summary">
                    <div class="bd-summary-label">Total Clients</div>
                    <div class="bd-summary-value" th:text="${clientStats['Total Clients']}">0</div>
                </div>
                <div class="bd-stat-content" id="client-stats">
                    <div class="bd-stat-item" th:each="stat : ${clientStats}"
                         th:if="${!stat.key.equals('Total Clients')}">
                        <div class="bd-stat-label" th:text="${stat.key}">Active Clients</div>
                        <div class="bd-stat-value" th:text="${stat.value}">0</div>
                    </div>
                </div>
            </div>

            <!-- Inspector Stats Card -->
            <div class="bd-stat-card" th:if="${inspectorStats != null}">
                <div class="bd-stat-header" data-target="inspector-stats">
                    <div class="bd-stat-icon bd-inspector-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="bd-stat-title">Inspectors</div>
                    <i class="fas fa-chevron-down bd-dropdown-icon"></i>
                </div>
                <div class="bd-stat-summary">
                    <div class="bd-summary-label">Total Inspectors</div>
                    <div class="bd-summary-value" th:text="${inspectorStats['Total Inspectors']}">0</div>
                </div>
                <div class="bd-stat-content" id="inspector-stats">
                    <div class="bd-stat-item" th:each="stat : ${inspectorStats}"
                         th:if="${!stat.key.equals('Total Inspectors')}">
                        <div class="bd-stat-label" th:text="${stat.key}">Inhouse Inspectors</div>
                        <div class="bd-stat-value" th:text="${stat.value}">0</div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</main>

<!-- Footer -->
<footer th:replace="fragments/footer :: footer"></footer>

<script th:inline="javascript">
    /*<![CDATA[*/
 let lastCoordinatorData = null;
let lastTechnicalData = null;
let lastInspectorData = null;

    document.addEventListener('DOMContentLoaded', function() {
        // Initialize toggle for stat cards
        initializeStatCardToggles();

        // Initialize tab navigation
        initializeTabNavigation();

        // Initialize comparison chart
        initializeComparisonChart();

        // Set current date for date inputs
        initializeDateInputs();
        updateComparisonChart();
    });

    function initializeStatCardToggles() {
        const statHeaders = document.querySelectorAll('.bd-stat-header');

        statHeaders.forEach(header => {
            header.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const content = document.getElementById(targetId);
                const icon = this.querySelector('.bd-dropdown-icon');

                content.classList.toggle('expanded');
                icon.classList.toggle('active');
            });
        });
    }

   function initializeTabNavigation() {
    const tabButtons = document.querySelectorAll('.bd-tab-button');

    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons and panels
            document.querySelectorAll('.bd-tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.bd-chart-panel').forEach(panel => panel.classList.remove('active'));

            // Add active class to clicked button
            this.classList.add('active');

            // Show the corresponding panel
            const targetPanelId = this.getAttribute('data-target');
            document.getElementById(targetPanelId).classList.add('active');

        });
    });
}
    function initializeDateInputs() {
        // Set default dates to 30 days ago and today
        const today = new Date();
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);

        // Format dates for input fields
        const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        // Set date values for all custom range inputs
        const startDateInputs = document.querySelectorAll('[id$="StartDate"]');
        const endDateInputs = document.querySelectorAll('[id$="EndDate"]');

        startDateInputs.forEach(input => input.value = formatDate(thirtyDaysAgo));
        endDateInputs.forEach(input => input.value = formatDate(today));
    }

    function initializeComparisonChart() {
        const ctx = document.getElementById('comparisonChart').getContext('2d');
        return new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Select users above to compare performance',
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    borderColor: '#858796',
                    backgroundColor: 'rgba(133, 135, 150, 0.1)',
                    borderWidth: 1,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Inspections Completed'
                        },
                        grid: {
                            display: true,
                            drawBorder: false,
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            boxWidth: 12,
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#5a5c69',
                        bodyColor: '#5a5c69',
                        borderColor: '#e3e6f0',
                        borderWidth: 1,
                        cornerRadius: 4,
                        displayColors: true,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y + ' inspections';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    // Period change handlers
    function handleCoordinatorPeriodChange() {
        const periodSelect = document.getElementById('coordinatorPeriodSelect');
        const customRangeContainer = document.getElementById('coordinatorCustomRangeContainer');

        if (periodSelect.value === 'custom') {
            customRangeContainer.style.display = 'block';
        } else {
            customRangeContainer.style.display = 'none';
            updateCoordinatorChartWithPeriod(periodSelect.value);
        }
    }

    function handleTechnicalPeriodChange() {
        const periodSelect = document.getElementById('technicalPeriodSelect');
        const customRangeContainer = document.getElementById('technicalCustomRangeContainer');

        if (periodSelect.value === 'custom') {
            customRangeContainer.style.display = 'block';
        } else {
            customRangeContainer.style.display = 'none';
            updateTechnicalChartWithPeriod(periodSelect.value);
        }
    }

    function handleInspectorPeriodChange() {
        const periodSelect = document.getElementById('inspectorPeriodSelect');
        const customRangeContainer = document.getElementById('inspectorCustomRangeContainer');

        if (periodSelect.value === 'custom') {
            customRangeContainer.style.display = 'block';
        } else {
            customRangeContainer.style.display = 'none';
            updateInspectorChartWithPeriod(periodSelect.value);
        }
    }

 function applyCoordinatorCustomRange() {
    const period = 'custom'; // Force custom period
    const selectedCoordinator = document.getElementById('coordinatorSelect').value;

    if (selectedCoordinator) {
        fetchCoordinatorMetricData(selectedCoordinator, period);
    } else {
        showNotification('Please select a coordinator first', 'warning');
    }
}

 function applyTechnicalCustomRange() {
    const period = 'custom'; // Force custom period
    const selectedTechCoordinator = document.getElementById('technicalCoordinatorSelect').value;

    if (selectedTechCoordinator) {
        fetchTechnicalMetricData(selectedTechCoordinator, period);
    } else {
        showNotification('Please select a technical coordinator first', 'warning');
    }
}

function applyInspectorCustomRange() {
    const period = 'custom'; // Force custom period
    const selectedInspector = document.getElementById('inspectorSelect').value;

    if (selectedInspector) {
        fetchInspectorMetricData(selectedInspector, period);
    } else {
        showNotification('Please select an inspector first', 'warning');
    }
}

    // Update chart with period
    function updateCoordinatorChartWithPeriod(period) {
        const selectedCoordinator = document.getElementById('coordinatorSelect').value;

        if (selectedCoordinator) {
            fetchCoordinatorMetricData(selectedCoordinator, period);
        }
    }

    function updateTechnicalChartWithPeriod(period) {
        const selectedTechCoordinator = document.getElementById('technicalCoordinatorSelect').value;

        if (selectedTechCoordinator) {
            fetchTechnicalMetricData(selectedTechCoordinator, period);
        }
    }

    function updateInspectorChartWithPeriod(period) {
        const selectedInspector = document.getElementById('inspectorSelect').value;

        if (selectedInspector) {
            fetchInspectorMetricData(selectedInspector, period);
        }
    }

    // Update chart with date range
    function updateCoordinatorChartWithDateRange(startDate, endDate) {
        const selectedCoordinator = document.getElementById('coordinatorSelect').value;

        if (selectedCoordinator) {
            fetchCoordinatorDateRangeData(selectedCoordinator, startDate, endDate);
        } else {
            showNotification('Please select a coordinator first', 'warning');
        }
    }

    // Handler for individual selection
    function handleCoordinatorChange(selectElement) {
        const selectedCoordinatorEmail = selectElement.value;
        const period = document.getElementById('coordinatorPeriodSelect').value;

        if (!selectedCoordinatorEmail) return;

        // Remove empty state and show loading
        removeEmptyState('coordinatorPerformanceContainer');
        showLoadingIndicator('coordinatorPerformanceContainer');

        fetchCoordinatorMetricData(selectedCoordinatorEmail, period);
    }

    function handleTechnicalCoordinatorChange(selectElement) {
        const selectedTechnicalCoordinator = selectElement.value;
        const period = document.getElementById('technicalPeriodSelect').value;

        if (!selectedTechnicalCoordinator) return;

        // Remove empty state and show loading
        removeEmptyState('technicalCoordinatorContainer');
        showLoadingIndicator('technicalCoordinatorContainer');

        fetchTechnicalMetricData(selectedTechnicalCoordinator, period);

    }

    function handleInspectorChange(selectElement) {
        const selectedInspector = selectElement.value;
        const period = document.getElementById('inspectorPeriodSelect').value;

        if (!selectedInspector) return;

        // Remove empty state and show loading
        removeEmptyState('inspectorPerformanceContainer');
        showLoadingIndicator('inspectorPerformanceContainer');

        fetchInspectorMetricData(selectedInspector, period);
    }

    // Update the fetch functions to match your API endpoints
    function fetchCoordinatorMetricData(coordinatorEmail, period) {
        showLoadingIndicator('coordinatorPerformanceContainer');
let url = `/stats/coordinator-stats/${encodeURIComponent(coordinatorEmail)}/${encodeURIComponent(period)}`;
// Handle custom date range
    if (period === 'custom') {
        const startDate = document.getElementById('coordinatorStartDate').value;
        const endDate = document.getElementById('coordinatorEndDate').value;

        if (!startDate || !endDate) {
            showNotification('Please select both start and end dates', 'error');
            hideLoadingIndicator('coordinatorPerformanceContainer');
            return;
        }

        if (new Date(startDate) > new Date(endDate)) {
            showNotification('Start date cannot be after end date', 'error');
            hideLoadingIndicator('coordinatorPerformanceContainer');
            return;
        }

        url += `?startDate=${startDate}&endDate=${endDate}`;
    }
        fetch(url, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
    hideLoadingIndicator('coordinatorPerformanceContainer');
    updateRoleMetricsDisplay('coordinator', data);

    const isNew = JSON.stringify(data) !== JSON.stringify(lastCoordinatorData);

    if (isNew) {
        lastCoordinatorData = data;

        if (hasMeaningfulInspectionData(data)) {
            const totalDisplay = document.getElementById('coordinatorTotalDisplay');
            if (totalDisplay) {
                totalDisplay.classList.add('bd-total-highlight');
                setTimeout(() => totalDisplay.classList.remove('bd-total-highlight'), 1500);
            }
            showNotification('Coordinator data updated successfully', 'success');
            updateComparisonChart();
        } else {
            showNotification('No data available for selected coordinator', 'warning');
        }
    }
}).catch(error => {
            hideLoadingIndicator('coordinatorPerformanceContainer');
            console.error('Error:', error);
            showNotification('Failed to fetch coordinator data. Please try again.', 'error');
        });
    }

    function fetchTechnicalMetricData(techCoordinatorId, period) {
        showLoadingIndicator('technicalCoordinatorContainer');
 let url = `/stats/technical-coordinator-stats/${encodeURIComponent(techCoordinatorId)}/${encodeURIComponent(period)}`;
  if (period === 'custom') {
        const startDate = document.getElementById('technicalStartDate').value;
        const endDate = document.getElementById('technicalEndDate').value;

        if (!startDate || !endDate) {
            showNotification('Please select both start and end dates', 'error');
            hideLoadingIndicator('technicalCoordinatorContainer');
            return;
        }

        if (new Date(startDate) > new Date(endDate)) {
            showNotification('Start date cannot be after end date', 'error');
            hideLoadingIndicator('technicalCoordinatorContainer');
            return;
        }

        url += `?startDate=${startDate}&endDate=${endDate}`;
    }
        fetch(url, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
      .then(data => {
    hideLoadingIndicator('technicalCoordinatorContainer');
    updateRoleMetricsDisplay('technical', data);

    const isNew = JSON.stringify(data) !== JSON.stringify(lastTechnicalData);

    if (isNew) {
        lastTechnicalData = data;

        if (hasMeaningfulInspectionData(data)) {
            const totalDisplay = document.getElementById('techCoordinatorTotalDisplay');
            if (totalDisplay) {
                totalDisplay.classList.add('bd-total-highlight');
                setTimeout(() => totalDisplay.classList.remove('bd-total-highlight'), 1500);
            }
            showNotification('Technical coordinator data updated successfully', 'success');
            updateComparisonChart();
        } else {
            showNotification('No data available for selected technical coordinator', 'warning');
        }
    }
}).catch(error => {
            hideLoadingIndicator('technicalCoordinatorContainer');
            console.error('Error:', error);
            showNotification('Failed to fetch technical coordinator data. Please try again.', 'error');
        });
    }

    function fetchInspectorMetricData(inspectorEmail, period) {
        showLoadingIndicator('inspectorPerformanceContainer');
let url = `/stats/inspector-stats/${encodeURIComponent(inspectorEmail)}/${encodeURIComponent(period)}`;
     if (period === 'custom') {
        const startDate = document.getElementById('inspectorStartDate').value;
        const endDate = document.getElementById('inspectorEndDate').value;

        if (!startDate || !endDate) {
            showNotification('Please select both start and end dates', 'error');
            hideLoadingIndicator('inspectorPerformanceContainer');
            return;
        }

        if (new Date(startDate) > new Date(endDate)) {
            showNotification('Start date cannot be after end date', 'error');
            hideLoadingIndicator('inspectorPerformanceContainer');
            return;
        }

        url += `?startDate=${startDate}&endDate=${endDate}`;
    }

        fetch(url, {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
.then(data => {
    hideLoadingIndicator('inspectorPerformanceContainer');
    updateRoleMetricsDisplay('inspector', data);

    const isNew = JSON.stringify(data) !== JSON.stringify(lastInspectorData);

    if (isNew) {
        lastInspectorData = data;

        if (hasMeaningfulInspectionData(data)) {
            const totalDisplay = document.getElementById('inspectorTotalDisplay');
            if (totalDisplay) {
                totalDisplay.classList.add('bd-total-highlight');
                setTimeout(() => totalDisplay.classList.remove('bd-total-highlight'), 1500);
            }
            showNotification('Inspector data updated successfully', 'success');
             updateComparisonChart();
        } else {
            showNotification('No data available for selected inspector', 'warning');
        }
    }
}).catch(error => {
            hideLoadingIndicator('inspectorPerformanceContainer');
            console.error('Error:', error);
            showNotification('Failed to fetch inspector data. Please try again.', 'error');
        });
    }

    function hasMeaningfulInspectionData(data) {
        return data.totalInspections > 0 ||
               data.newInspections > 0 ||
               data.completedInspections > 0 ||
               data.ongoingInspections > 0 ||
               data.rejectedInspections > 0;
    }

    function updateRoleMetricsDisplay(roleType, data) {
        let containerId;
        if (roleType === 'technical') {
            containerId = 'technicalCoordinatorContainer';
        } else {
            containerId = `${roleType}PerformanceContainer`;
        }

        const container = document.getElementById(containerId);

        // Get the selected name from the dropdown
        let selectedName = "";
        if (roleType === 'coordinator') {
            const select = document.getElementById('coordinatorSelect');
            selectedName = select.options[select.selectedIndex].text;
        } else if (roleType === 'technical') {
            const select = document.getElementById('technicalCoordinatorSelect');
            selectedName = select.options[select.selectedIndex].text;
        } else if (roleType === 'inspector') {
            const select = document.getElementById('inspectorSelect');
            selectedName = select.options[select.selectedIndex].text;
        }

        // Format period text
        const periodText = formatPeriodText(data.period);

        // Create the metrics display HTML
        const metricsHTML = `
            <div class="bd-metrics-display">
                <div class="bd-metrics-header">
                    <h3>${selectedName}</h3>
                    <span class="bd-period-label">${periodText}</span>
                </div>
                <div class="bd-metrics-total">
                    <span class="bd-total-number">${data.totalInspections}</span>
                    <span class="bd-total-label">Total Inspections</span>
                </div>
                <div class="bd-metrics-breakdown">
                    <div class="bd-metric-item">
                        <span class="bd-metric-value">${data.newInspections || 0}</span>
                        <span class="bd-metric-label">New</span>
                    </div>
                    <div class="bd-metric-item">
                        <span class="bd-metric-value">${data.ongoingInspections || 0}</span>
                        <span class="bd-metric-label">Ongoing</span>
                    </div>
                    <div class="bd-metric-item">
                        <span class="bd-metric-value">${data.completedInspections || 0}</span>
                        <span class="bd-metric-label">Awarded</span>
                    </div>
                    <div class="bd-metric-item">
                        <span class="bd-metric-value">${data.rejectedInspections || 0}</span>
                        <span class="bd-metric-label">Rejected</span>
                    </div>
                </div>
            </div>
        `;

        container.innerHTML = metricsHTML;
    }

    // Helper function to format period text
    function formatPeriodText(period) {
        switch(period) {
            case 'WEEK': return 'Last 7 Days';
            case 'MONTH': return 'Last 30 Days';
            case 'QUARTER': return 'Last Quarter';
            case 'YEAR': return 'Year to Date';
            case 'CUSTOM': return 'Custom Range';
            default: return period;
        }
    }

    function exportCoordinatorData(format) {
    const exportBtn = event.target.closest('.bd-export-btn');
    if (!exportBtn) return;

    const coordinatorSelect = document.getElementById('coordinatorSelect');
    const coordinatorEmail = coordinatorSelect.value;
    const coordinatorName = coordinatorSelect.selectedOptions[0]?.text || 'report';
    const period = document.getElementById('coordinatorPeriodSelect').value;

    const startDate = document.getElementById('startDate')?.value;
    const endDate = document.getElementById('endDate')?.value;

    if (!coordinatorEmail) {
        showNotification('Please select a coordinator before exporting.', 'warning');
        return;
    }

    // Disable button and show loading state
    exportBtn.disabled = true;
    const originalText = exportBtn.innerHTML;
    exportBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Processing...`;

    let endpoint = `/stats/coordinator-report/${coordinatorEmail}/${period}/${format}`;
    const queryParams = [];

    if (startDate) queryParams.push(`startDate=${encodeURIComponent(startDate)}`);
    if (endDate) queryParams.push(`endDate=${encodeURIComponent(endDate)}`);

    if (queryParams.length > 0) {
        endpoint += `?${queryParams.join('&')}`;
    }

    const filename = `${coordinatorName.replace(/\s+/g, '_')}_report.${format === 'pdf' ? 'pdf' : 'xlsx'}`;

    fetch(endpoint)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error: ${response.status}`);
            }
            return response.blob();
        })
        .then(blob => {
            if (blob.size === 0) {
                showNotification('No data available for report generation', 'warning');
                return;
            }
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(link.href);

            showNotification(`${format.toUpperCase()} downloaded successfully.`, 'success');
        })
        .catch(error => {
            console.error('Download failed:', error);
            showNotification(`Failed to export ${format.toUpperCase()} report.`, 'error');
        })
        .finally(() => {
            // Restore button state
            exportBtn.disabled = false;
            exportBtn.innerHTML = originalText;
        });
}

function exportTechnicalData(format) {
    const exportBtn = event.target.closest('.bd-export-btn');
    if (!exportBtn) return;

    const selectedTechCoordinator = document.getElementById('technicalCoordinatorSelect').value;
    const techCoordinatorName = document.getElementById('technicalCoordinatorSelect').selectedOptions[0]?.text || 'report';
    const period = document.getElementById('technicalPeriodSelect').value;

    if (!selectedTechCoordinator) {
        showNotification('Please select a technical coordinator before exporting.', 'warning');
        return;
    }

    // Disable button and show loading state
    exportBtn.disabled = true;
    const originalText = exportBtn.innerHTML;
    exportBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Processing...`;

    // For custom range
    let endpoint = `/stats/technical-coordinator-report/${selectedTechCoordinator}/${period}/${format}`;

    if (period === 'custom') {
        const startDate = document.getElementById('technicalStartDate').value;
        const endDate = document.getElementById('technicalEndDate').value;
        if (!startDate || !endDate) {
            showNotification('Please select both start and end dates', 'error');
            exportBtn.disabled = false;
            exportBtn.innerHTML = originalText;
            return;
        }
        endpoint += `?startDate=${startDate}&endDate=${endDate}`;
    }

    const filename = `${techCoordinatorName.replace(/\s+/g, '_')}_report.${format === 'pdf' ? 'pdf' : 'xlsx'}`;

    fetch(endpoint)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error: ${response.status}`);
            }
            return response.blob();
        })
        .then(blob => {
        if (blob.size === 0) {
                showNotification('No data available for report generation', 'warning');
                return;
            }
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(link.href);

            showNotification(`${format.toUpperCase()} downloaded successfully.`, 'success');
        })
        .catch(error => {
            console.error('Download failed:', error);
            showNotification(`Failed to export ${format.toUpperCase()} report.`, 'error');
        })
        .finally(() => {
            // Restore button state
            exportBtn.disabled = false;
            exportBtn.innerHTML = originalText;
        });
}

function exportInspectorData(format) {
    const exportBtn = event.target.closest('.bd-export-btn');
    if (!exportBtn) return;

    const selectedInspector = document.getElementById('inspectorSelect').value;
    const inspectorName = document.getElementById('inspectorSelect').selectedOptions[0]?.text || 'report';
    const period = document.getElementById('inspectorPeriodSelect').value;

    if (!selectedInspector) {
        showNotification('Please select an inspector before exporting.', 'warning');
        return;
    }

    // Disable button and show loading state
    exportBtn.disabled = true;
    const originalText = exportBtn.innerHTML;
    exportBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Processing...`;

    // For custom range
    let endpoint = `/stats/inspector-report/${selectedInspector}/${period}/${format}`;

    if (period === 'custom') {
        const startDate = document.getElementById('inspectorStartDate').value;
        const endDate = document.getElementById('inspectorEndDate').value;
        if (!startDate || !endDate) {
            showNotification('Please select both start and end dates', 'error');
            exportBtn.disabled = false;
            exportBtn.innerHTML = originalText;
            return;
        }
        endpoint += `?startDate=${startDate}&endDate=${endDate}`;
    }

    const filename = `${inspectorName.replace(/\s+/g, '_')}_report.${format === 'pdf' ? 'pdf' : 'xlsx'}`;

    fetch(endpoint)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error: ${response.status}`);
            }
            return response.blob();
        })
        .then(blob => {
        if (blob.size === 0) {
                showNotification('No data available for report generation', 'warning');
                return;
            }
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(link.href);

            showNotification(`${format.toUpperCase()} downloaded successfully.`, 'success');
        })
        .catch(error => {
            console.error('Download failed:', error);
            showNotification(`Failed to export ${format.toUpperCase()} report.`, 'error');
        })
        .finally(() => {
            // Restore button state
            exportBtn.disabled = false;
            exportBtn.innerHTML = originalText;
        });
}

// Utility functions
function showLoadingIndicator(containerId) {
    const container = document.getElementById(containerId);

    // Create loading overlay if it doesn't exist
    if (!container.querySelector('.bd-loading-overlay')) {
        const loadingOverlay = document.createElement('div');
        loadingOverlay.className = 'bd-loading-overlay';
        loadingOverlay.innerHTML = `
            <div class="bd-loading-spinner">
                <i class="fas fa-circle-notch fa-spin"></i>
            </div>
            <div class="bd-loading-text">Loading data...</div>
        `;

        container.style.position = 'relative';
        container.appendChild(loadingOverlay);
    } else {
        container.querySelector('.bd-loading-overlay').style.display = 'flex';
    }
}

function hideLoadingIndicator(containerId) {
    const container = document.getElementById(containerId);
    const loadingOverlay = container.querySelector('.bd-loading-overlay');

    if (loadingOverlay) {
        loadingOverlay.style.display = 'none';
    }
}

function removeEmptyState(containerId) {
    const container = document.getElementById(containerId);
    const emptyState = container.querySelector('.bd-empty-state');

    if (emptyState) {
        container.removeChild(emptyState);
    }
}

function showNotification(message, type = 'info') {
    // Check if notification container exists, if not create it
    let notificationContainer = document.getElementById('bd-notification-container');
    if (!notificationContainer) {
        notificationContainer = document.createElement('div');
        notificationContainer.id = 'bd-notification-container';
        document.body.appendChild(notificationContainer);
    }

    // Create notification element
    const notification = document.createElement('div');
    notification.className = `bd-notification bd-notification-${type}`;

    // Set icon based on type
    let icon;
    switch (type) {
        case 'success':
            icon = 'fa-check-circle';
            break;
        case 'error':
            icon = 'fa-times-circle';
            break;
        case 'warning':
            icon = 'fa-exclamation-triangle';
            break;
        default:
            icon = 'fa-info-circle';
    }

    notification.innerHTML = `
        <div class="bd-notification-icon">
            <i class="fas ${icon}"></i>
        </div>
        <div class="bd-notification-content">
            ${message}
        </div>
        <div class="bd-notification-close">
            <i class="fas fa-times"></i>
        </div>
    `;

    // Add to container
    notificationContainer.appendChild(notification);

    // Add event listener to close button
    notification.querySelector('.bd-notification-close').addEventListener('click', function() {
        notification.classList.add('bd-notification-hiding');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    });

    // Auto-remove after delay
    setTimeout(() => {
        if (notification.parentNode) {
            notification.classList.add('bd-notification-hiding');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }
    }, 5000);
}
function showComparisonLoader() {
    const loader = document.getElementById('comparisonChartLoader');
    if (loader) loader.style.display = 'flex';
}

function hideComparisonLoader() {
    const loader = document.getElementById('comparisonChartLoader');
    if (loader) loader.style.display = 'none';
}
function updateComparisonChart() {
    const chart = Chart.getChart('comparisonChart');
    if (!chart) return;

    const coordinator = document.getElementById('coordinatorSelect')?.value;
    const technical = document.getElementById('technicalCoordinatorSelect')?.value;
    const inspector = document.getElementById('inspectorSelect')?.value;

    // Only pass selected values if actually chosen (non-placeholder)
    const selectedCoordinator = coordinator !== "" ? coordinator : null;
    const selectedTechnical = technical !== "" ? technical : null;
    const selectedInspector = inspector !== "" ? inspector : null;

    const url = `/business/trend-data?coordinator=${encodeURIComponent(selectedCoordinator || "")}&technical=${encodeURIComponent(selectedTechnical || "")}&inspector=${encodeURIComponent(selectedInspector || "")}`;

    showComparisonLoader();

    fetch(url)
        .then(response => response.json())
        .then(data => {
            hideComparisonLoader();

            if (!data || !data.datasets || data.datasets.length === 0) {
                chart.data.labels = [];
                chart.data.datasets = [{
                    label: 'No Data Available',
                    data: [],
                    borderColor: '#e74a3b',
                    backgroundColor: 'rgba(231, 74, 59, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true
                }];
                chart.update();
                return;
            }

            chart.data.labels = data.labels;
            chart.data.datasets = data.datasets.map((ds, index) => ({
                label: ds.label,
                data: ds.data,
                borderColor: getLineColor(index),
                backgroundColor: 'rgba(0, 123, 255, 0.05)',
                borderWidth: 2,
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 6
            }));

const titleParts = ['All Inspections'];
if (selectedCoordinator) {
    const select = document.getElementById('coordinatorSelect');
    const name = select.options[select.selectedIndex]?.text;
    if (name) titleParts.push(`${name} (Coordinator)`);
}
if (selectedTechnical) {
    const select = document.getElementById('technicalCoordinatorSelect');
    const name = select.options[select.selectedIndex]?.text;
    if (name) titleParts.push(`${name} (Technical)`);
}
if (selectedInspector) {
    const select = document.getElementById('inspectorSelect');
    const name = select.options[select.selectedIndex]?.text;
    if (name) titleParts.push(`${name} (Inspector)`);
}

chart.options.plugins.title = {
    display: true,
    text: titleParts.length > 1
        ? titleParts.join(' vs ')
        : 'All Inspections Trend',
    font: {
        size: 16,
        weight: 'bold'
    },
    padding: {
        top: 10,
        bottom: 20
    }
};
            chart.update();
        })
        .catch(err => {
            hideComparisonLoader();
            console.error("Trend data fetch failed", err);
            showNotification('Unable to load performance trends.', 'error');
        });
}






function getLineColor(index) {
    const colors = ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'];
    return colors[index % colors.length];
}

// Helper function to generate random data for demonstration
function generateRandomData(count, min, max) {
    const data = [];
    for (let i = 0; i < count; i++) {
        data.push(Math.floor(Math.random() * (max - min + 1)) + min);
    }
    return data;
}
// Add event listeners after DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Set up listeners for individual select changes
    document.getElementById('coordinatorSelect').addEventListener('change', function() {
        handleCoordinatorChange(this);

    });
    document.getElementById('technicalCoordinatorSelect').addEventListener('change', function() {
        handleTechnicalCoordinatorChange(this);

    });
    document.getElementById('inspectorSelect').addEventListener('change', function() {
        handleInspectorChange(this);
        x
    });

    // Also update comparison chart when period changes
    document.getElementById('coordinatorPeriodSelect').addEventListener('change', updateComparisonChart);
    document.getElementById('technicalPeriodSelect').addEventListener('change', updateComparisonChart);
    document.getElementById('inspectorPeriodSelect').addEventListener('change', updateComparisonChart);
});

/*]]>*/
</script>
<style>
    /* Main Container Styles */
    .bd-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    .bd-dashboard-container {
        background-color: #f8f9fc;
        border-radius: 8px;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        padding: 20px;
    }

    .bd-dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 20px;
        border-bottom: 1px solid #e3e6f0;
        margin-bottom: 20px;
    }

    .bd-dashboard-title {
        font-size: 24px;
        font-weight: 700;
        color: #4e73df;
    }

    .bd-date-filter {
        font-size: 16px;
        color: #858796;
    }

    /* Stats Grid Styles */
    .bd-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .bd-stat-card {
        background-color: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    .bd-stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .bd-stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        cursor: pointer;
        border-bottom: 1px solid #f1f1f1;
    }

    .bd-stat-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        color: #fff;
    }

    .bd-inspection-icon {
        background-color: #4e73df;
    }

    .bd-employee-icon {
        background-color: #1cc88a;
    }

    .bd-client-icon {
        background-color: #36b9cc;
    }

    .bd-inspector-icon {
        background-color: #f6c23e;
    }

    .bd-stat-title {
        font-size: 16px;
        font-weight: 600;
        flex: 1;
        margin-left: 15px;
    }

    .bd-dropdown-icon {
        font-size: 14px;
        color: #858796;
        transition: transform 0.3s ease;
    }

    .bd-dropdown-icon.active {
        transform: rotate(180deg);
    }

    .bd-stat-summary {
        padding: 15px;
        text-align: center;
        background-color: #fafafa;
    }

    .bd-summary-label {
        font-size: 14px;
        color: #858796;
        margin-bottom: 5px;
    }

    .bd-summary-value {
        font-size: 24px;
        font-weight: 700;
        color: #5a5c69;
    }

    .bd-stat-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
    }

    .bd-stat-content.expanded {
        max-height: 500px;
    }

    .bd-stat-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 15px;
        border-top: 1px solid #f1f1f1;
    }

    .bd-stat-label {
        font-size: 14px;
        color: #858796;
    }

    .bd-stat-value {
        font-weight: 600;
        color: #5a5c69;
    }

    /* Chart Section Styles */
    .bd-chart-section, .bd-trends-section {
        margin-bottom: 30px;
    }

    .bd-section-header {
        margin-bottom: 20px;
    }

    .bd-section-header h2 {
        font-size: 20px;
        font-weight: 700;
        color: #4e73df;
        margin-bottom: 5px;
    }

    .bd-section-header p {
        font-size: 14px;
        color: #858796;
    }

    .bd-tab-navigation {
        display: flex;
        border-bottom: 1px solid #e3e6f0;
        margin-bottom: 20px;
    }
.bd-total-inspections-display {
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    background-color: #f8f9fc;
    border-radius: 0.35rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 0.15rem 1.75rem rgba(58, 59, 69, 0.15);
    transition: all 0.3s ease;
}

.bd-total-inspections-display .bd-total-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.bd-total-inspections-display .bd-total-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: #5a5c69;
}

.bd-total-inspections-display .bd-period-label {
    font-size: 0.9rem;
    color: #858796;
    background-color: rgba(78, 115, 223, 0.1);
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
}

.bd-total-inspections-display .bd-total-value {
    display: flex;
    align-items: baseline;
}

.bd-total-inspections-display .bd-total-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #4e73df;
    margin-right: 1rem;
}

.bd-total-inspections-display .bd-total-label {
    font-size: 1.1rem;
    color: #858796;
}

/* Add animation for when total changes */
@keyframes highlight {
    0% { background-color: #f8f9fc; }
    50% { background-color: rgba(78, 115, 223, 0.2); }
    100% { background-color: #f8f9fc; }
}

.bd-total-highlight {
    animation: highlight 1.5s ease;
}
    .bd-tab-button {
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 600;
        color: #858796;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        transition: all 0.2s ease;
    }

<!--    .bd-tab-button:hover {-->
<!--        color: #4e73df;-->
<!--    }-->

    .bd-tab-button.active {
        color: #4e73df;
        border-bottom-color: #4e73df;
    }

    .bd-chart-panel {
        display: none;
    }

    .bd-chart-panel.active {
        display: block;
    }

    .bd-chart-card {
        background-color: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin-bottom: 20px;
    }

    .bd-chart-controls-container {
        margin-bottom: 20px;
    }

    .bd-chart-header {
        font-size: 18px;
        font-weight: 700;
        color: #5a5c69;
        margin-bottom: 15px;
    }

    .bd-filters-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: flex-end;
    }

    .bd-filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .bd-filter-group label {
        font-size: 13px;
        color: #858796;
    }

    .bd-select, .bd-period-select {
        min-width: 180px;
        padding: 8px 12px;
        border: 1px solid #e3e6f0;
        border-radius: 4px;
        font-size: 14px;
        color: #5a5c69;
        background-color: #fff;
    }

    .bd-primary-filter {
        flex: 0.4;
        min-width: 220px;
    }

    .bd-primary-select {
        width: 100%;
    }

    .bd-export-group {
        display: flex;
        flex-direction: row;
        gap: 8px;
        margin-left: auto;
    }
.bd-metrics-breakdown {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    border-top: 1px solid rgba(0,0,0,0.1);
    padding-top: 15px;
}

.bd-metric-item {
    text-align: center;
    flex: 1;
    padding: 0 10px;
    border-right: 1px solid rgba(0,0,0,0.1);
}

.bd-metric-item:last-child {
    border-right: none;
}

.bd-metric-value {
    display: block;
    font-size: 1.2rem;
    font-weight: 700;
    color: #4e73df;
}

.bd-metric-label {
    display: block;
    font-size: 0.8rem;
    color: #858796;
    margin-top: 5px;
}

/* Color coding for different metrics */
.bd-metric-item:nth-child(1) .bd-metric-value {
    color: #4e73df; /* New - blue */
}

.bd-metric-item:nth-child(2) .bd-metric-value {
    color: #1cc88a; /* Ongoing - green */
}

.bd-metric-item:nth-child(3) .bd-metric-value {
    color: #36b9cc; /* Awarded - teal */
}

.bd-metric-item:nth-child(4) .bd-metric-value {
    color: #f6c23e; /* Rejected - yellow */
}

/* Make the total display a bit more prominent */
.bd-total-inspections-display {
    background-color: #fff;
    border-radius: 0.35rem;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
}
    .bd-export-btn {
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        background-color: #f8f9fc;
        color: #5a5c69;
        border: 1px solid #e3e6f0;
        transition: all 0.2s ease;
    }

    .bd-export-btn:hover {
        background-color: #eaecf4;
    }

    .bd-export-btn i {
        margin-right: 5px;
    }

    .bd-custom-range {
        background-color: #f8f9fc;
        border: 1px solid #e3e6f0;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .bd-custom-range-content {
        display: flex;
        gap: 15px;
        align-items: flex-end;
    }

    .bd-date-input-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .bd-date-input-group label {
        font-size: 13px;
        color: #858796;
    }

    .bd-date-input-group input[type="date"] {
        padding: 8px 12px;
        border: 1px solid #e3e6f0;
        border-radius: 4px;
        font-size: 14px;
        color: #5a5c69;
    }

    .bd-filter-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 600;
        background-color: #4e73df;
        color: white;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .bd-filter-btn:hover {
        background-color: #2e59d9;
    }

    .bd-chart-container {
        position: relative;
        width: 100%;
        margin-bottom: 20px;
    }

    .bd-loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10;
    }

    .bd-loading-spinner {
        font-size: 36px;
        color: #4e73df;
        margin-bottom: 10px;
    }

    .bd-loading-text {
        font-size: 14px;
        color: #5a5c69;
    }

    .bd-data-summary {
        margin-top: 20px;
    }

    .bd-data-summary h3 {
        font-size: 16px;
        font-weight: 700;
        color: #5a5c69;
        margin-bottom: 15px;
    }

    .bd-data-table-container {
        overflow-x: auto;
    }

    .bd-data-table {
        width: 100%;
        border-collapse: collapse;
    }

    .bd-data-table th,
    .bd-data-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e3e6f0;
    }

    .bd-data-table th {
        font-size: 14px;
        font-weight: 600;
        color: #4e73df;
        background-color: #f8f9fc;
    }

    .bd-data-table td {
        font-size: 14px;
        color: #5a5c69;
    }

    .bd-trend-up {
        color: #1cc88a;
    }

    .bd-trend-down {
        color: #e74a3b;
    }

    .bd-trend-neutral {
        color: #f6c23e;
    }

    .bd-trends-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }

    /* Notification Styles */
    #bd-notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 300px;
        max-width: 90%;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .bd-notification {
        background-color: white;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        padding: 15px;
        align-items: center;
        animation: slideIn 0.3s forwards;
        overflow: hidden;
    }

    .bd-notification-hiding {
        animation: slideOut 0.3s forwards;
    }

    .bd-notification-icon {
        font-size: 20px;
        margin-right: 12px;
    }

    .bd-notification-success .bd-notification-icon {
        color: #1cc88a;
    }

    .bd-notification-error .bd-notification-icon {
        color: #e74a3b;
    }

    .bd-notification-warning .bd-notification-icon {
        color: #f6c23e;
    }

    .bd-notification-info .bd-notification-icon {
        color: #36b9cc;
    }

    .bd-notification-content {
        flex: 1;
        font-size: 14px;
        color: #5a5c69;
    }

    .bd-notification-close {
        margin-left: 12px;
        cursor: pointer;
        color: #858796;
        font-size: 14px;
        transition: color 0.2s ease;
    }

    .bd-notification-close:hover {
        color: #5a5c69;
    }

    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }

    /* Responsive Adjustments */
    @media (max-width: 992px) {
        .bd-filters-container {
            flex-direction: column;
            align-items: stretch;
        }

        .bd-export-group {
            margin-left: 0;
            justify-content: flex-end;
        }
    }

    @media (max-width: 768px) {
        .bd-dashboard-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .bd-date-filter {
            margin-top: 10px;
        }

        .bd-custom-range-content {
            flex-direction: column;
            align-items: stretch;
        }

        .bd-filter-btn {
            margin-top: 10px;
        }
    }
    .bd-no-data-message {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    background-color: rgba(255, 255, 255, 0.8);
    border-radius: 0.5rem;
}

.bd-no-data-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: #d1d3e2;
}

.bd-no-data-text {
    font-weight: 500;
}
    /* Performance Metrics Display Styles */
.bd-performance-metrics-container {
    background-color: #fff;
    border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    padding: 20px;
    min-height: 300px;
    position: relative;
}

.bd-metrics-display {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.bd-metrics-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 10px;
    border-bottom: 1px solid #e3e6f0;
}

.bd-metrics-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 700;
    color: #5a5c69;
}

.bd-period-label {
    font-size: 14px;
    color: #858796;
    background-color: rgba(78, 115, 223, 0.1);
    padding: 4px 12px;
    border-radius: 12px;
}

.bd-metrics-total {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    background-color: #f8f9fc;
    border-radius: 6px;
}

.bd-total-number {
    font-size: 36px;
    font-weight: 700;
    color: #4e73df;
    line-height: 1;
    margin-bottom: 5px;
}

.bd-total-label {
    font-size: 16px;
    color: #858796;
}

.bd-metrics-breakdown {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}

.bd-metric-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    background-color: #f8f9fc;
    border-radius: 6px;
    text-align: center;
}

.bd-metric-value {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 5px;
}

.bd-metric-label {
    font-size: 14px;
    color: #858796;
}

/* Color coding for different metrics */
.bd-metric-item:nth-child(1) .bd-metric-value {
    color: #4e73df; /* New - blue */
}

.bd-metric-item:nth-child(2) .bd-metric-value {
    color: #1cc88a; /* Ongoing - green */
}

.bd-metric-item:nth-child(3) .bd-metric-value {
    color: #36b9cc; /* Awarded - teal */
}

.bd-metric-item:nth-child(4) .bd-metric-value {
    color: #f6c23e; /* Rejected - yellow */
}

/* Empty state styles */
.bd-empty-state {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: #858796;
    width: 100%;
    padding: 20px;
}

.bd-empty-state-icon {
    font-size: 48px;
    margin-bottom: 15px;
    color: #d1d3e2;
}

.bd-empty-state-text {
    font-size: 16px;
    font-weight: 500;
}

/* Loading overlay styles */
.bd-loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
}

.bd-loading-spinner {
    font-size: 36px;
    color: #4e73df;
    margin-bottom: 10px;
    animation: fa-spin 2s infinite linear;
}

.bd-loading-text {
    font-size: 14px;
    color: #5a5c69;
}

/* Highlight animation */
@keyframes bd-highlight {
    0% { background-color: #f8f9fc; }
    50% { background-color: rgba(78, 115, 223, 0.2); }
    100% { background-color: #f8f9fc; }
}

.bd-total-highlight {
    animation: bd-highlight 1.5s ease;
}
</style>
</body>
</html>